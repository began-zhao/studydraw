import{_ as c}from"./plugin-vue_export-helper.21dcd24c.js";import{o as i,c as l,b as s,a as e,w as u,e as a,d as n,r as t}from"./app.34c4c188.js";var r="/assets/\u8FDE\u63A5ZooKeeper\u670D\u52A1.d35718b3.png",d="/assets/curator.1108d06e.png";const k={},v=a(`<h1 id="zookeeper-\u5B9E\u6218" tabindex="-1"><a class="header-anchor" href="#zookeeper-\u5B9E\u6218" aria-hidden="true">#</a> ZooKeeper \u5B9E\u6218</h1><h2 id="_1-\u524D\u8A00" tabindex="-1"><a class="header-anchor" href="#_1-\u524D\u8A00" aria-hidden="true">#</a> 1. \u524D\u8A00</h2><p>\u8FD9\u7BC7\u6587\u7AE0\u7B80\u5355\u7ED9\u6F14\u793A\u4E00\u4E0B ZooKeeper \u5E38\u89C1\u547D\u4EE4\u7684\u4F7F\u7528\u4EE5\u53CA ZooKeeper Java\u5BA2\u6237\u7AEF Curator \u7684\u57FA\u672C\u4F7F\u7528\u3002\u4ECB\u7ECD\u5230\u7684\u5185\u5BB9\u90FD\u662F\u6700\u57FA\u672C\u7684\u64CD\u4F5C\uFF0C\u80FD\u6EE1\u8DB3\u65E5\u5E38\u5DE5\u4F5C\u7684\u57FA\u672C\u9700\u8981\u3002</p><p>\u5982\u679C\u6587\u7AE0\u6709\u4EFB\u4F55\u9700\u8981\u6539\u5584\u548C\u5B8C\u5584\u7684\u5730\u65B9\uFF0C\u6B22\u8FCE\u5728\u8BC4\u8BBA\u533A\u6307\u51FA\uFF0C\u5171\u540C\u8FDB\u6B65\uFF01</p><h2 id="_2-zookeeper-\u5B89\u88C5\u548C\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#_2-zookeeper-\u5B89\u88C5\u548C\u4F7F\u7528" aria-hidden="true">#</a> 2. ZooKeeper \u5B89\u88C5\u548C\u4F7F\u7528</h2><h3 id="_2-1-\u4F7F\u7528docker-\u5B89\u88C5-zookeeper" tabindex="-1"><a class="header-anchor" href="#_2-1-\u4F7F\u7528docker-\u5B89\u88C5-zookeeper" aria-hidden="true">#</a> 2.1. \u4F7F\u7528Docker \u5B89\u88C5 zookeeper</h3><p><strong>a.\u4F7F\u7528 Docker \u4E0B\u8F7D ZooKeeper</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> pull zookeeper:3.5.8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>b.\u8FD0\u884C ZooKeeper</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> run -d --name zookeeper -p <span class="token number">2181</span>:2181 zookeeper:3.5.8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_2-2-\u8FDE\u63A5-zookeeper-\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#_2-2-\u8FDE\u63A5-zookeeper-\u670D\u52A1" aria-hidden="true">#</a> 2.2. \u8FDE\u63A5 ZooKeeper \u670D\u52A1</h3><p><strong>a.\u8FDB\u5165ZooKeeper\u5BB9\u5668\u4E2D</strong></p><p>\u5148\u4F7F\u7528 <code>docker ps</code> \u67E5\u770B ZooKeeper \u7684 ContainerID\uFF0C\u7136\u540E\u4F7F\u7528 <code>docker exec -it ContainerID /bin/bash</code> \u547D\u4EE4\u8FDB\u5165\u5BB9\u5668\u4E2D\u3002</p><p><strong>b.\u5148\u8FDB\u5165 bin \u76EE\u5F55,\u7136\u540E\u901A\u8FC7 <code>./zkCli.sh -server 127.0.0.1:2181</code>\u547D\u4EE4\u8FDE\u63A5ZooKeeper \u670D\u52A1</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>root@eaf70fc620cb:/apache-zookeeper-3.5.8-bin<span class="token comment"># cd bin</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5982\u679C\u4F60\u770B\u5230\u63A7\u5236\u53F0\u6210\u529F\u6253\u5370\u51FA\u5982\u4E0B\u4FE1\u606F\u7684\u8BDD\uFF0C\u8BF4\u660E\u4F60\u5DF2\u7ECF\u6210\u529F\u8FDE\u63A5 ZooKeeper \u670D\u52A1\u3002</p><p><img src="`+r+`" alt="" loading="lazy"></p><h3 id="_2-3-\u5E38\u7528\u547D\u4EE4\u6F14\u793A" tabindex="-1"><a class="header-anchor" href="#_2-3-\u5E38\u7528\u547D\u4EE4\u6F14\u793A" aria-hidden="true">#</a> 2.3. \u5E38\u7528\u547D\u4EE4\u6F14\u793A</h3><h4 id="_2-3-1-\u67E5\u770B\u5E38\u7528\u547D\u4EE4-help-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_2-3-1-\u67E5\u770B\u5E38\u7528\u547D\u4EE4-help-\u547D\u4EE4" aria-hidden="true">#</a> 2.3.1. \u67E5\u770B\u5E38\u7528\u547D\u4EE4(help \u547D\u4EE4)</h4><p>\u901A\u8FC7 <code>help</code> \u547D\u4EE4\u67E5\u770B ZooKeeper \u5E38\u7528\u547D\u4EE4</p><h4 id="_2-3-2-\u521B\u5EFA\u8282\u70B9-create-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_2-3-2-\u521B\u5EFA\u8282\u70B9-create-\u547D\u4EE4" aria-hidden="true">#</a> 2.3.2. \u521B\u5EFA\u8282\u70B9(create \u547D\u4EE4)</h4><p>\u901A\u8FC7 <code>create</code> \u547D\u4EE4\u5728\u6839\u76EE\u5F55\u521B\u5EFA\u4E86 node1 \u8282\u70B9\uFF0C\u4E0E\u5B83\u5173\u8054\u7684\u5B57\u7B26\u4E32\u662F&quot;node1&quot;</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: <span class="token number">127.0</span>.0.1:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">34</span><span class="token punctuation">]</span> create /node1 \u201Cnode1\u201D
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u901A\u8FC7 <code>create</code> \u547D\u4EE4\u5728\u6839\u76EE\u5F55\u521B\u5EFA\u4E86 node1 \u8282\u70B9\uFF0C\u4E0E\u5B83\u5173\u8054\u7684\u5185\u5BB9\u662F\u6570\u5B57 123</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: <span class="token number">127.0</span>.0.1:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">]</span> create /node1/node1.1 <span class="token number">123</span>
Created /node1/node1.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-3-\u66F4\u65B0\u8282\u70B9\u6570\u636E\u5185\u5BB9-set-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_2-3-3-\u66F4\u65B0\u8282\u70B9\u6570\u636E\u5185\u5BB9-set-\u547D\u4EE4" aria-hidden="true">#</a> 2.3.3. \u66F4\u65B0\u8282\u70B9\u6570\u636E\u5185\u5BB9(set \u547D\u4EE4)</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: <span class="token number">127.0</span>.0.1:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">11</span><span class="token punctuation">]</span> <span class="token builtin class-name">set</span> /node1 <span class="token string">&quot;set node1&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_2-3-4-\u83B7\u53D6\u8282\u70B9\u7684\u6570\u636E-get-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_2-3-4-\u83B7\u53D6\u8282\u70B9\u7684\u6570\u636E-get-\u547D\u4EE4" aria-hidden="true">#</a> 2.3.4. \u83B7\u53D6\u8282\u70B9\u7684\u6570\u636E(get \u547D\u4EE4)</h4><p><code>get</code> \u547D\u4EE4\u53EF\u4EE5\u83B7\u53D6\u6307\u5B9A\u8282\u70B9\u7684\u6570\u636E\u5185\u5BB9\u548C\u8282\u70B9\u7684\u72B6\u6001,\u53EF\u4EE5\u770B\u51FA\u6211\u4EEC\u901A\u8FC7 <code>set</code> \u547D\u4EE4\u5DF2\u7ECF\u5C06\u8282\u70B9\u6570\u636E\u5185\u5BB9\u6539\u4E3A &quot;set node1&quot;\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">set</span> node1
cZxid <span class="token operator">=</span> 0x47
ctime <span class="token operator">=</span> Sun Jan <span class="token number">20</span> <span class="token number">10</span>:22:59 CST <span class="token number">2019</span>
mZxid <span class="token operator">=</span> 0x4b
mtime <span class="token operator">=</span> Sun Jan <span class="token number">20</span> <span class="token number">10</span>:41:10 CST <span class="token number">2019</span>
pZxid <span class="token operator">=</span> 0x4a
cversion <span class="token operator">=</span> <span class="token number">1</span>
dataVersion <span class="token operator">=</span> <span class="token number">1</span>
aclVersion <span class="token operator">=</span> <span class="token number">0</span>
ephemeralOwner <span class="token operator">=</span> 0x0
dataLength <span class="token operator">=</span> <span class="token number">9</span>
numChildren <span class="token operator">=</span> <span class="token number">1</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-5-\u67E5\u770B\u67D0\u4E2A\u76EE\u5F55\u4E0B\u7684\u5B50\u8282\u70B9-ls-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_2-3-5-\u67E5\u770B\u67D0\u4E2A\u76EE\u5F55\u4E0B\u7684\u5B50\u8282\u70B9-ls-\u547D\u4EE4" aria-hidden="true">#</a> 2.3.5. \u67E5\u770B\u67D0\u4E2A\u76EE\u5F55\u4E0B\u7684\u5B50\u8282\u70B9(ls \u547D\u4EE4)</h4><p>\u901A\u8FC7 <code>ls</code> \u547D\u4EE4\u67E5\u770B\u6839\u76EE\u5F55\u4E0B\u7684\u8282\u70B9</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: <span class="token number">127.0</span>.0.1:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">37</span><span class="token punctuation">]</span> <span class="token function">ls</span> /
<span class="token punctuation">[</span>dubbo, ZooKeeper, node1<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u901A\u8FC7 <code>ls</code> \u547D\u4EE4\u67E5\u770B node1 \u76EE\u5F55\u4E0B\u7684\u8282\u70B9</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: <span class="token number">127.0</span>.0.1:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token function">ls</span> /node1
<span class="token punctuation">[</span>node1.1<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ZooKeeper \u4E2D\u7684 ls \u547D\u4EE4\u548C linux \u547D\u4EE4\u4E2D\u7684 ls \u7C7B\u4F3C\uFF0C \u8FD9\u4E2A\u547D\u4EE4\u5C06\u5217\u51FA\u7EDD\u5BF9\u8DEF\u5F84 path \u4E0B\u7684\u6240\u6709\u5B50\u8282\u70B9\u4FE1\u606F\uFF08\u5217\u51FA 1 \u7EA7\uFF0C\u5E76\u4E0D\u9012\u5F52\uFF09</p><h4 id="_2-3-6-\u67E5\u770B\u8282\u70B9\u72B6\u6001-stat-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_2-3-6-\u67E5\u770B\u8282\u70B9\u72B6\u6001-stat-\u547D\u4EE4" aria-hidden="true">#</a> 2.3.6. \u67E5\u770B\u8282\u70B9\u72B6\u6001(stat \u547D\u4EE4)</h4><p>\u901A\u8FC7 <code>stat</code> \u547D\u4EE4\u67E5\u770B\u8282\u70B9\u72B6\u6001</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: <span class="token number">127.0</span>.0.1:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">10</span><span class="token punctuation">]</span> <span class="token function">stat</span> /node1
cZxid <span class="token operator">=</span> 0x47
ctime <span class="token operator">=</span> Sun Jan <span class="token number">20</span> <span class="token number">10</span>:22:59 CST <span class="token number">2019</span>
mZxid <span class="token operator">=</span> 0x47
mtime <span class="token operator">=</span> Sun Jan <span class="token number">20</span> <span class="token number">10</span>:22:59 CST <span class="token number">2019</span>
pZxid <span class="token operator">=</span> 0x4a
cversion <span class="token operator">=</span> <span class="token number">1</span>
dataVersion <span class="token operator">=</span> <span class="token number">0</span>
aclVersion <span class="token operator">=</span> <span class="token number">0</span>
ephemeralOwner <span class="token operator">=</span> 0x0
dataLength <span class="token operator">=</span> <span class="token number">11</span>
numChildren <span class="token operator">=</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,39),m=n("\u4E0A\u9762\u663E\u793A\u7684\u4E00\u4E9B\u4FE1\u606F\u6BD4\u5982 cversion\u3001aclVersion\u3001numChildren \u7B49\u7B49\uFF0C\u6211\u5728\u4E0A\u9762 \u201C"),b={href:"https://javaguide.cn/distributed-system/distributed-process-coordination/zookeeper/zookeeper-intro.html",target:"_blank",rel:"noopener noreferrer"},h=n("ZooKeeper \u76F8\u5173\u6982\u5FF5\u603B\u7ED3(\u5165\u95E8)"),g=n("\u201D \u8FD9\u7BC7\u6587\u7AE0\u4E2D\u5DF2\u7ECF\u4ECB\u7ECD\u5230\u3002"),f=a(`<h4 id="_2-3-7-\u67E5\u770B\u8282\u70B9\u4FE1\u606F\u548C\u72B6\u6001-ls2-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_2-3-7-\u67E5\u770B\u8282\u70B9\u4FE1\u606F\u548C\u72B6\u6001-ls2-\u547D\u4EE4" aria-hidden="true">#</a> 2.3.7. \u67E5\u770B\u8282\u70B9\u4FE1\u606F\u548C\u72B6\u6001(ls2 \u547D\u4EE4)</h4><p><code>ls2</code> \u547D\u4EE4\u66F4\u50CF\u662F <code>ls</code> \u547D\u4EE4\u548C <code>stat</code> \u547D\u4EE4\u7684\u7ED3\u5408\u3002 <code>ls2</code> \u547D\u4EE4\u8FD4\u56DE\u7684\u4FE1\u606F\u5305\u62EC 2 \u90E8\u5206\uFF1A</p><ol><li>\u5B50\u8282\u70B9\u5217\u8868</li><li>\u5F53\u524D\u8282\u70B9\u7684 stat \u4FE1\u606F\u3002</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: <span class="token number">127.0</span>.0.1:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">7</span><span class="token punctuation">]</span> ls2 /node1
<span class="token punctuation">[</span>node1.1<span class="token punctuation">]</span>
cZxid <span class="token operator">=</span> 0x47
ctime <span class="token operator">=</span> Sun Jan <span class="token number">20</span> <span class="token number">10</span>:22:59 CST <span class="token number">2019</span>
mZxid <span class="token operator">=</span> 0x47
mtime <span class="token operator">=</span> Sun Jan <span class="token number">20</span> <span class="token number">10</span>:22:59 CST <span class="token number">2019</span>
pZxid <span class="token operator">=</span> 0x4a
cversion <span class="token operator">=</span> <span class="token number">1</span>
dataVersion <span class="token operator">=</span> <span class="token number">0</span>
aclVersion <span class="token operator">=</span> <span class="token number">0</span>
ephemeralOwner <span class="token operator">=</span> 0x0
dataLength <span class="token operator">=</span> <span class="token number">11</span>
numChildren <span class="token operator">=</span> <span class="token number">1</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-8-\u5220\u9664\u8282\u70B9-delete-\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_2-3-8-\u5220\u9664\u8282\u70B9-delete-\u547D\u4EE4" aria-hidden="true">#</a> 2.3.8. \u5220\u9664\u8282\u70B9(delete \u547D\u4EE4)</h4><p>\u8FD9\u4E2A\u547D\u4EE4\u5F88\u7B80\u5355\uFF0C\u4F46\u662F\u9700\u8981\u6CE8\u610F\u7684\u4E00\u70B9\u662F\u5982\u679C\u4F60\u8981\u5220\u9664\u67D0\u4E00\u4E2A\u8282\u70B9\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u8282\u70B9\u5FC5\u987B\u65E0\u5B50\u8282\u70B9\u624D\u884C\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: <span class="token number">127.0</span>.0.1:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">3</span><span class="token punctuation">]</span> delete /node1/node1.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5728\u540E\u9762\u6211\u4F1A\u4ECB\u7ECD\u5230 Java \u5BA2\u6237\u7AEF API \u7684\u4F7F\u7528\u4EE5\u53CA\u5F00\u6E90 ZooKeeper \u5BA2\u6237\u7AEF ZkClient \u548C Curator \u7684\u4F7F\u7528\u3002</p><h2 id="_3-zookeeper-java\u5BA2\u6237\u7AEF-curator\u7B80\u5355\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#_3-zookeeper-java\u5BA2\u6237\u7AEF-curator\u7B80\u5355\u4F7F\u7528" aria-hidden="true">#</a> 3. ZooKeeper Java\u5BA2\u6237\u7AEF Curator\u7B80\u5355\u4F7F\u7528</h2><p>Curator \u662FNetflix\u516C\u53F8\u5F00\u6E90\u7684\u4E00\u5957 ZooKeeper Java\u5BA2\u6237\u7AEF\u6846\u67B6\uFF0C\u76F8\u6BD4\u4E8E Zookeeper \u81EA\u5E26\u7684\u5BA2\u6237\u7AEF zookeeper \u6765\u8BF4\uFF0CCurator \u7684\u5C01\u88C5\u66F4\u52A0\u5B8C\u5584\uFF0C\u5404\u79CD API \u90FD\u53EF\u4EE5\u6BD4\u8F83\u65B9\u4FBF\u5730\u4F7F\u7528\u3002</p><p><img src="`+d+`" alt="" loading="lazy"></p><p>\u4E0B\u9762\u6211\u4EEC\u5C31\u6765\u7B80\u5355\u5730\u6F14\u793A\u4E00\u4E0B Curator \u7684\u4F7F\u7528\u5427\uFF01</p><p>Curator4.0+\u7248\u672C\u5BF9ZooKeeper 3.5.x\u652F\u6301\u6BD4\u8F83\u597D\u3002\u5F00\u59CB\u4E4B\u524D\uFF0C\u8BF7\u5148\u5C06\u4E0B\u9762\u7684\u4F9D\u8D56\u6DFB\u52A0\u8FDB\u4F60\u7684\u9879\u76EE\u3002</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.curator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>curator-framework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.curator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>curator-recipes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-1-\u8FDE\u63A5-zookeeper-\u5BA2\u6237\u7AEF" tabindex="-1"><a class="header-anchor" href="#_3-1-\u8FDE\u63A5-zookeeper-\u5BA2\u6237\u7AEF" aria-hidden="true">#</a> 3.1. \u8FDE\u63A5 ZooKeeper \u5BA2\u6237\u7AEF</h3><p>\u901A\u8FC7 <code>CuratorFrameworkFactory</code> \u521B\u5EFA <code>CuratorFramework</code> \u5BF9\u8C61\uFF0C\u7136\u540E\u518D\u8C03\u7528 <code>CuratorFramework</code> \u5BF9\u8C61\u7684 <code>start()</code> \u65B9\u6CD5\u5373\u53EF\uFF01</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> BASE_SLEEP_TIME <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MAX_RETRIES <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

<span class="token comment">// Retry strategy. Retry 3 times, and will increase the sleep time between retries.</span>
<span class="token class-name">RetryPolicy</span> retryPolicy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExponentialBackoffRetry</span><span class="token punctuation">(</span>BASE_SLEEP_TIME<span class="token punctuation">,</span> MAX_RETRIES<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">CuratorFramework</span> zkClient <span class="token operator">=</span> <span class="token class-name">CuratorFrameworkFactory</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// the server to connect to (can be a server list)</span>
    <span class="token punctuation">.</span><span class="token function">connectString</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:2181&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">retryPolicy</span><span class="token punctuation">(</span>retryPolicy<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
zkClient<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5BF9\u4E8E\u4E00\u4E9B\u57FA\u672C\u53C2\u6570\u7684\u8BF4\u660E\uFF1A</p><ul><li><code>baseSleepTimeMs</code>\uFF1A\u91CD\u8BD5\u4E4B\u95F4\u7B49\u5F85\u7684\u521D\u59CB\u65F6\u95F4</li><li><code>maxRetries</code> \uFF1A\u6700\u5927\u91CD\u8BD5\u6B21\u6570</li><li><code>connectString</code> \uFF1A\u8981\u8FDE\u63A5\u7684\u670D\u52A1\u5668\u5217\u8868</li><li><code>retryPolicy</code> \uFF1A\u91CD\u8BD5\u7B56\u7565</li></ul><h3 id="_3-2-\u6570\u636E\u8282\u70B9\u7684\u589E\u5220\u6539\u67E5" tabindex="-1"><a class="header-anchor" href="#_3-2-\u6570\u636E\u8282\u70B9\u7684\u589E\u5220\u6539\u67E5" aria-hidden="true">#</a> 3.2. \u6570\u636E\u8282\u70B9\u7684\u589E\u5220\u6539\u67E5</h3><h4 id="_3-2-1-\u521B\u5EFA\u8282\u70B9" tabindex="-1"><a class="header-anchor" href="#_3-2-1-\u521B\u5EFA\u8282\u70B9" aria-hidden="true">#</a> 3.2.1. \u521B\u5EFA\u8282\u70B9</h4>`,21),_=n("\u6211\u4EEC\u5728 "),x=n("ZooKeeper\u5E38\u89C1\u6982\u5FF5\u89E3\u8BFB"),C=n(" \u4E2D\u4ECB\u7ECD\u5230\uFF0C\u6211\u4EEC\u901A\u5E38\u662F\u5C06 znode \u5206\u4E3A 4 \u5927\u7C7B\uFF1A"),E=a(`<ul><li><strong>\u6301\u4E45\uFF08PERSISTENT\uFF09\u8282\u70B9</strong> \uFF1A\u4E00\u65E6\u521B\u5EFA\u5C31\u4E00\u76F4\u5B58\u5728\u5373\u4F7F ZooKeeper \u96C6\u7FA4\u5B95\u673A\uFF0C\u76F4\u5230\u5C06\u5176\u5220\u9664\u3002</li><li><strong>\u4E34\u65F6\uFF08EPHEMERAL\uFF09\u8282\u70B9</strong> \uFF1A\u4E34\u65F6\u8282\u70B9\u7684\u751F\u547D\u5468\u671F\u662F\u4E0E <strong>\u5BA2\u6237\u7AEF\u4F1A\u8BDD\uFF08session\uFF09</strong> \u7ED1\u5B9A\u7684\uFF0C<strong>\u4F1A\u8BDD\u6D88\u5931\u5219\u8282\u70B9\u6D88\u5931</strong> \u3002\u5E76\u4E14\uFF0C\u4E34\u65F6\u8282\u70B9 <strong>\u53EA\u80FD\u505A\u53F6\u5B50\u8282\u70B9</strong> \uFF0C\u4E0D\u80FD\u521B\u5EFA\u5B50\u8282\u70B9\u3002</li><li><strong>\u6301\u4E45\u987A\u5E8F\uFF08PERSISTENT_SEQUENTIAL\uFF09\u8282\u70B9</strong> \uFF1A\u9664\u4E86\u5177\u6709\u6301\u4E45\uFF08PERSISTENT\uFF09\u8282\u70B9\u7684\u7279\u6027\u4E4B\u5916\uFF0C \u5B50\u8282\u70B9\u7684\u540D\u79F0\u8FD8\u5177\u6709\u987A\u5E8F\u6027\u3002\u6BD4\u5982 <code>/node1/app0000000001</code> \u3001<code>/node1/app0000000002</code> \u3002</li><li><strong>\u4E34\u65F6\u987A\u5E8F\uFF08EPHEMERAL_SEQUENTIAL\uFF09\u8282\u70B9</strong> \uFF1A\u9664\u4E86\u5177\u5907\u4E34\u65F6\uFF08EPHEMERAL\uFF09\u8282\u70B9\u7684\u7279\u6027\u4E4B\u5916\uFF0C\u5B50\u8282\u70B9\u7684\u540D\u79F0\u8FD8\u5177\u6709\u987A\u5E8F\u6027\u3002</li></ul><p>\u4F60\u5728\u4F7F\u7528\u7684ZooKeeper \u7684\u65F6\u5019\uFF0C\u4F1A\u53D1\u73B0 <code>CreateMode</code> \u7C7B\u4E2D\u5B9E\u9645\u6709 7\u79CD znode \u7C7B\u578B \uFF0C\u4F46\u662F\u7528\u7684\u6700\u591A\u7684\u8FD8\u662F\u4E0A\u9762\u4ECB\u7ECD\u7684 4 \u79CD\u3002</p><p><strong>a.\u521B\u5EFA\u6301\u4E45\u5316\u8282\u70B9</strong></p><p>\u4F60\u53EF\u4EE5\u901A\u8FC7\u4E0B\u9762\u4E24\u79CD\u65B9\u5F0F\u521B\u5EFA\u6301\u4E45\u5316\u7684\u8282\u70B9\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//\u6CE8\u610F:\u4E0B\u9762\u7684\u4EE3\u7801\u4F1A\u62A5\u9519\uFF0C\u4E0B\u6587\u8BF4\u4E86\u5177\u4F53\u539F\u56E0</span>
zkClient<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node1/00001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
zkClient<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMode</span><span class="token punctuation">(</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span>PERSISTENT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node1/00002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F46\u662F\uFF0C\u4F60\u8FD0\u884C\u4E0A\u9762\u7684\u4EE3\u7801\u4F1A\u62A5\u9519\uFF0C\u8FD9\u662F\u56E0\u4E3A\u7684\u7236\u8282\u70B9<code>node1</code>\u8FD8\u672A\u521B\u5EFA\u3002</p><p>\u4F60\u53EF\u4EE5\u5148\u521B\u5EFA\u7236\u8282\u70B9 <code>node1</code> \uFF0C\u7136\u540E\u518D\u6267\u884C\u4E0A\u9762\u7684\u4EE3\u7801\u5C31\u4E0D\u4F1A\u62A5\u9519\u4E86\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>zkClient<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u66F4\u63A8\u8350\u7684\u65B9\u5F0F\u662F\u901A\u8FC7\u4E0B\u9762\u8FD9\u884C\u4EE3\u7801\uFF0C <strong><code>creatingParentsIfNeeded()</code> \u53EF\u4EE5\u4FDD\u8BC1\u7236\u8282\u70B9\u4E0D\u5B58\u5728\u7684\u65F6\u5019\u81EA\u52A8\u521B\u5EFA\u7236\u8282\u70B9\uFF0C\u8FD9\u662F\u975E\u5E38\u6709\u7528\u7684\u3002</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>zkClient<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">creatingParentsIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMode</span><span class="token punctuation">(</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span>PERSISTENT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node1/00001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>b.\u521B\u5EFA\u4E34\u65F6\u8282\u70B9</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>zkClient<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">creatingParentsIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMode</span><span class="token punctuation">(</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span>EPHEMERAL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node1/00001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>c.\u521B\u5EFA\u8282\u70B9\u5E76\u6307\u5B9A\u6570\u636E\u5185\u5BB9</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>zkClient<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">creatingParentsIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMode</span><span class="token punctuation">(</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span>EPHEMERAL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node1/00001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;java&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
zkClient<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node1/00001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u83B7\u53D6\u8282\u70B9\u7684\u6570\u636E\u5185\u5BB9\uFF0C\u83B7\u53D6\u5230\u7684\u662F byte\u6570\u7EC4</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>d.\u68C0\u6D4B\u8282\u70B9\u662F\u5426\u521B\u5EFA\u6210\u529F</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>zkClient<span class="token punctuation">.</span><span class="token function">checkExists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node1/00001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u4E0D\u4E3Anull\u7684\u8BDD\uFF0C\u8BF4\u660E\u8282\u70B9\u521B\u5EFA\u6210\u529F</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_3-2-2-\u5220\u9664\u8282\u70B9" tabindex="-1"><a class="header-anchor" href="#_3-2-2-\u5220\u9664\u8282\u70B9" aria-hidden="true">#</a> 3.2.2. \u5220\u9664\u8282\u70B9</h4><p><strong>a.\u5220\u9664\u4E00\u4E2A\u5B50\u8282\u70B9</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>zkClient<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node1/00001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>b.\u5220\u9664\u4E00\u4E2A\u8282\u70B9\u4EE5\u53CA\u5176\u4E0B\u7684\u6240\u6709\u5B50\u8282\u70B9</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>zkClient<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">deletingChildrenIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_3-2-3-\u83B7\u53D6-\u66F4\u65B0\u8282\u70B9\u6570\u636E\u5185\u5BB9" tabindex="-1"><a class="header-anchor" href="#_3-2-3-\u83B7\u53D6-\u66F4\u65B0\u8282\u70B9\u6570\u636E\u5185\u5BB9" aria-hidden="true">#</a> 3.2.3. \u83B7\u53D6/\u66F4\u65B0\u8282\u70B9\u6570\u636E\u5185\u5BB9</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>zkClient<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">creatingParentsIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMode</span><span class="token punctuation">(</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span>EPHEMERAL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node1/00001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;java&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
zkClient<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node1/00001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u83B7\u53D6\u8282\u70B9\u7684\u6570\u636E\u5185\u5BB9</span>
zkClient<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node1/00001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;c++&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u66F4\u65B0\u8282\u70B9\u6570\u636E\u5185\u5BB9</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-4-\u83B7\u53D6\u67D0\u4E2A\u8282\u70B9\u7684\u6240\u6709\u5B50\u8282\u70B9\u8DEF\u5F84" tabindex="-1"><a class="header-anchor" href="#_3-2-4-\u83B7\u53D6\u67D0\u4E2A\u8282\u70B9\u7684\u6240\u6709\u5B50\u8282\u70B9\u8DEF\u5F84" aria-hidden="true">#</a> 3.2.4. \u83B7\u53D6\u67D0\u4E2A\u8282\u70B9\u7684\u6240\u6709\u5B50\u8282\u70B9\u8DEF\u5F84</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> childrenPaths <span class="token operator">=</span> zkClient<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,25);function z(q,P){const p=t("ExternalLinkIcon"),o=t("RouterLink");return i(),l("div",null,[v,s("p",null,[m,s("a",b,[h,e(p)]),g]),f,s("p",null,[_,e(o,{to:"/code/java/distributed-system/distributed-process-coordination/zookeeper/zookeeper-intro.html"},{default:u(()=>[x]),_:1}),C]),E])}var S=c(k,[["render",z],["__file","zookeeper-in-action.html.vue"]]);export{S as default};
