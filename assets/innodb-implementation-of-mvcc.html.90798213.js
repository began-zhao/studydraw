import{_ as i}from"./plugin-vue_export-helper.21dcd24c.js";import{o as t,c as s,b as e,a as c,d as o,e as n,r as a}from"./app.8c8575b4.js";var l="/assets/trans_visible.048192c5.png",_="/assets/317e91e1-1ee1-42ad-9412-9098d5c6a9ad.dc43aed3.png",r="/assets/c52ff79f-10e6-46cb-b5d4-3c9cbcc1934a.b60a6e78.png",p="/assets/6a276e7a-b0da-4c7b-bdf7-c0c7b7b3b31c.2e496ea1.png",m="/assets/8778836b-34a8-480b-b8c7-654fe207a8c2.3d84010e.png",h="/assets/6fb2b9a1-5f14-4dec-a797-e4cf388ed413.ea9e47d7.png",u="/assets/a3fd1ec6-8f37-42fa-b090-7446d488fd04.bf41f07c.png",g="/assets/528559e9-dae8-4d14-b78d-a5b657c88391.2ff79120.png",R="/assets/6f82703c-36a1-4458-90fe-d7f4edbac71a.c8de5ed7.png",b="/assets/0e906b95-c916-4f30-beda-9cb3e49746bf.3a363d10.png",D="/assets/79ed6142-7664-4e0b-9023-cf546586aa39.9c5cd303.png",f="/assets/cbbedbc5-0e3c-4711-aafd-7f3d68a4ed4e.7b4a86c0.png";const v={},I=e("h2",{id:"\u4E00\u81F4\u6027\u975E\u9501\u5B9A\u8BFB\u548C\u9501\u5B9A\u8BFB",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u4E00\u81F4\u6027\u975E\u9501\u5B9A\u8BFB\u548C\u9501\u5B9A\u8BFB","aria-hidden":"true"},"#"),o(" \u4E00\u81F4\u6027\u975E\u9501\u5B9A\u8BFB\u548C\u9501\u5B9A\u8BFB")],-1),B=e("h3",{id:"\u4E00\u81F4\u6027\u975E\u9501\u5B9A\u8BFB",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u4E00\u81F4\u6027\u975E\u9501\u5B9A\u8BFB","aria-hidden":"true"},"#"),o(" \u4E00\u81F4\u6027\u975E\u9501\u5B9A\u8BFB")],-1),k=o("\u5BF9\u4E8E "),V={href:"https://dev.mysql.com/doc/refman/5.7/en/innodb-consistent-read.html",target:"_blank",rel:"noopener noreferrer"},w=e("strong",null,"\u4E00\u81F4\u6027\u975E\u9501\u5B9A\u8BFB\uFF08Consistent Nonlocking Reads\uFF09",-1),C=o(),T=o("\u7684\u5B9E\u73B0\uFF0C\u901A\u5E38\u505A\u6CD5\u662F\u52A0\u4E00\u4E2A\u7248\u672C\u53F7\u6216\u8005\u65F6\u95F4\u6233\u5B57\u6BB5\uFF0C\u5728\u66F4\u65B0\u6570\u636E\u7684\u540C\u65F6\u7248\u672C\u53F7 + 1 \u6216\u8005\u66F4\u65B0\u65F6\u95F4\u6233\u3002\u67E5\u8BE2\u65F6\uFF0C\u5C06\u5F53\u524D\u53EF\u89C1\u7684\u7248\u672C\u53F7\u4E0E\u5BF9\u5E94\u8BB0\u5F55\u7684\u7248\u672C\u53F7\u8FDB\u884C\u6BD4\u5BF9\uFF0C\u5982\u679C\u8BB0\u5F55\u7684\u7248\u672C\u5C0F\u4E8E\u53EF\u89C1\u7248\u672C\uFF0C\u5219\u8868\u793A\u8BE5\u8BB0\u5F55\u53EF\u89C1"),x=o("\u5728 "),X=e("code",null,"InnoDB",-1),y=o(" \u5B58\u50A8\u5F15\u64CE\u4E2D\uFF0C"),L={href:"https://dev.mysql.com/doc/refman/5.7/en/innodb-multi-versioning.html",target:"_blank",rel:"noopener noreferrer"},E=o("\u591A\u7248\u672C\u63A7\u5236 (multi versioning)"),M=o(" \u5C31\u662F\u5BF9\u975E\u9501\u5B9A\u8BFB\u7684\u5B9E\u73B0\u3002\u5982\u679C\u8BFB\u53D6\u7684\u884C\u6B63\u5728\u6267\u884C "),A=e("code",null,"DELETE",-1),z=o(" \u6216 "),q=e("code",null,"UPDATE",-1),N=o(" \u64CD\u4F5C\uFF0C\u8FD9\u65F6\u8BFB\u53D6\u64CD\u4F5C\u4E0D\u4F1A\u53BB\u7B49\u5F85\u884C\u4E0A\u9501\u7684\u91CA\u653E\u3002\u76F8\u53CD\u5730\uFF0C"),O=e("code",null,"InnoDB",-1),P=o(" \u5B58\u50A8\u5F15\u64CE\u4F1A\u53BB\u8BFB\u53D6\u884C\u7684\u4E00\u4E2A\u5FEB\u7167\u6570\u636E\uFF0C\u5BF9\u4E8E\u8FD9\u79CD\u8BFB\u53D6\u5386\u53F2\u6570\u636E\u7684\u65B9\u5F0F\uFF0C\u6211\u4EEC\u53EB\u5B83\u5FEB\u7167\u8BFB (snapshot read)"),S=n('<p>\u5728 <code>Repeatable Read</code> \u548C <code>Read Committed</code> \u4E24\u4E2A\u9694\u79BB\u7EA7\u522B\u4E0B\uFF0C\u5982\u679C\u662F\u6267\u884C\u666E\u901A\u7684 <code>select</code> \u8BED\u53E5\uFF08\u4E0D\u5305\u62EC <code>select ... lock in share mode</code> ,<code>select ... for update</code>\uFF09\u5219\u4F1A\u4F7F\u7528 <code>\u4E00\u81F4\u6027\u975E\u9501\u5B9A\u8BFB\uFF08MVCC\uFF09</code>\u3002\u5E76\u4E14\u5728 <code>Repeatable Read</code> \u4E0B <code>MVCC</code> \u5B9E\u73B0\u4E86\u53EF\u91CD\u590D\u8BFB\u548C\u9632\u6B62\u90E8\u5206\u5E7B\u8BFB</p><h3 id="\u9501\u5B9A\u8BFB" tabindex="-1"><a class="header-anchor" href="#\u9501\u5B9A\u8BFB" aria-hidden="true">#</a> \u9501\u5B9A\u8BFB</h3>',2),Q=o("\u5982\u679C\u6267\u884C\u7684\u662F\u4E0B\u5217\u8BED\u53E5\uFF0C\u5C31\u662F "),U={href:"https://dev.mysql.com/doc/refman/5.7/en/innodb-locking-reads.html",target:"_blank",rel:"noopener noreferrer"},W=e("strong",null,"\u9501\u5B9A\u8BFB\uFF08Locking Reads\uFF09",-1),j=n('<ul><li><code>select ... lock in share mode</code></li><li><code>select ... for update</code></li><li><code>insert</code>\u3001<code>update</code>\u3001<code>delete</code> \u64CD\u4F5C</li></ul><p>\u5728\u9501\u5B9A\u8BFB\u4E0B\uFF0C\u8BFB\u53D6\u7684\u662F\u6570\u636E\u7684\u6700\u65B0\u7248\u672C\uFF0C\u8FD9\u79CD\u8BFB\u4E5F\u88AB\u79F0\u4E3A <code>\u5F53\u524D\u8BFB\uFF08current read\uFF09</code>\u3002\u9501\u5B9A\u8BFB\u4F1A\u5BF9\u8BFB\u53D6\u5230\u7684\u8BB0\u5F55\u52A0\u9501\uFF1A</p><ul><li><p><code>select ... lock in share mode</code>\uFF1A\u5BF9\u8BB0\u5F55\u52A0 <code>S</code> \u9501\uFF0C\u5176\u5B83\u4E8B\u52A1\u4E5F\u53EF\u4EE5\u52A0<code>S</code>\u9501\uFF0C\u5982\u679C\u52A0 <code>x</code> \u9501\u5219\u4F1A\u88AB\u963B\u585E</p></li><li><p><code>select ... for update</code>\u3001<code>insert</code>\u3001<code>update</code>\u3001<code>delete</code>\uFF1A\u5BF9\u8BB0\u5F55\u52A0 <code>X</code> \u9501\uFF0C\u4E14\u5176\u5B83\u4E8B\u52A1\u4E0D\u80FD\u52A0\u4EFB\u4F55\u9501</p></li></ul><p>\u5728\u4E00\u81F4\u6027\u975E\u9501\u5B9A\u8BFB\u4E0B\uFF0C\u5373\u4F7F\u8BFB\u53D6\u7684\u8BB0\u5F55\u5DF2\u88AB\u5176\u5B83\u4E8B\u52A1\u52A0\u4E0A <code>X</code> \u9501\uFF0C\u8FD9\u65F6\u8BB0\u5F55\u4E5F\u662F\u53EF\u4EE5\u88AB\u8BFB\u53D6\u7684\uFF0C\u5373\u8BFB\u53D6\u7684\u5FEB\u7167\u6570\u636E\u3002\u4E0A\u9762\u8BF4\u4E86\uFF0C\u5728 <code>Repeatable Read</code> \u4E0B <code>MVCC</code> \u9632\u6B62\u4E86\u90E8\u5206\u5E7B\u8BFB\uFF0C\u8FD9\u8FB9\u7684 \u201C\u90E8\u5206\u201D \u662F\u6307\u5728 <code>\u4E00\u81F4\u6027\u975E\u9501\u5B9A\u8BFB</code> \u60C5\u51B5\u4E0B\uFF0C\u53EA\u80FD\u8BFB\u53D6\u5230\u7B2C\u4E00\u6B21\u67E5\u8BE2\u4E4B\u524D\u6240\u63D2\u5165\u7684\u6570\u636E\uFF08\u6839\u636E Read View \u5224\u65AD\u6570\u636E\u53EF\u89C1\u6027\uFF0CRead View \u5728\u7B2C\u4E00\u6B21\u67E5\u8BE2\u65F6\u751F\u6210\uFF09\u3002\u4F46\u662F\uFF01\u5982\u679C\u662F <code>\u5F53\u524D\u8BFB</code> \uFF0C\u6BCF\u6B21\u8BFB\u53D6\u7684\u90FD\u662F\u6700\u65B0\u6570\u636E\uFF0C\u8FD9\u65F6\u5982\u679C\u4E24\u6B21\u67E5\u8BE2\u4E2D\u95F4\u6709\u5176\u5B83\u4E8B\u52A1\u63D2\u5165\u6570\u636E\uFF0C\u5C31\u4F1A\u4EA7\u751F\u5E7B\u8BFB\u3002\u6240\u4EE5\uFF0C <strong><code>InnoDB</code> \u5728\u5B9E\u73B0<code>Repeatable Read</code> \u65F6\uFF0C\u5982\u679C\u6267\u884C\u7684\u662F\u5F53\u524D\u8BFB\uFF0C\u5219\u4F1A\u5BF9\u8BFB\u53D6\u7684\u8BB0\u5F55\u4F7F\u7528 <code>Next-key Lock</code> \uFF0C\u6765\u9632\u6B62\u5176\u5B83\u4E8B\u52A1\u5728\u95F4\u9699\u95F4\u63D2\u5165\u6570\u636E</strong></p><h2 id="innodb-\u5BF9-mvcc-\u7684\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#innodb-\u5BF9-mvcc-\u7684\u5B9E\u73B0" aria-hidden="true">#</a> InnoDB \u5BF9 MVCC \u7684\u5B9E\u73B0</h2><p><code>MVCC</code> \u7684\u5B9E\u73B0\u4F9D\u8D56\u4E8E\uFF1A<strong>\u9690\u85CF\u5B57\u6BB5\u3001Read View\u3001undo log</strong>\u3002\u5728\u5185\u90E8\u5B9E\u73B0\u4E2D\uFF0C<code>InnoDB</code> \u901A\u8FC7\u6570\u636E\u884C\u7684 <code>DB_TRX_ID</code> \u548C <code>Read View</code> \u6765\u5224\u65AD\u6570\u636E\u7684\u53EF\u89C1\u6027\uFF0C\u5982\u4E0D\u53EF\u89C1\uFF0C\u5219\u901A\u8FC7\u6570\u636E\u884C\u7684 <code>DB_ROLL_PTR</code> \u627E\u5230 <code>undo log</code> \u4E2D\u7684\u5386\u53F2\u7248\u672C\u3002\u6BCF\u4E2A\u4E8B\u52A1\u8BFB\u5230\u7684\u6570\u636E\u7248\u672C\u53EF\u80FD\u662F\u4E0D\u4E00\u6837\u7684\uFF0C\u5728\u540C\u4E00\u4E2A\u4E8B\u52A1\u4E2D\uFF0C\u7528\u6237\u53EA\u80FD\u770B\u5230\u8BE5\u4E8B\u52A1\u521B\u5EFA <code>Read View</code> \u4E4B\u524D\u5DF2\u7ECF\u63D0\u4EA4\u7684\u4FEE\u6539\u548C\u8BE5\u4E8B\u52A1\u672C\u8EAB\u505A\u7684\u4FEE\u6539</p><h3 id="\u9690\u85CF\u5B57\u6BB5" tabindex="-1"><a class="header-anchor" href="#\u9690\u85CF\u5B57\u6BB5" aria-hidden="true">#</a> \u9690\u85CF\u5B57\u6BB5</h3>',7),F=o("\u5728\u5185\u90E8\uFF0C"),G=e("code",null,"InnoDB",-1),H=o(" \u5B58\u50A8\u5F15\u64CE\u4E3A\u6BCF\u884C\u6570\u636E\u6DFB\u52A0\u4E86\u4E09\u4E2A "),J={href:"https://dev.mysql.com/doc/refman/5.7/en/innodb-multi-versioning.html",target:"_blank",rel:"noopener noreferrer"},K=o("\u9690\u85CF\u5B57\u6BB5"),Y=o("\uFF1A"),Z=n(`<ul><li><code>DB_TRX_ID\uFF086\u5B57\u8282\uFF09</code>\uFF1A\u8868\u793A\u6700\u540E\u4E00\u6B21\u63D2\u5165\u6216\u66F4\u65B0\u8BE5\u884C\u7684\u4E8B\u52A1 id\u3002\u6B64\u5916\uFF0C<code>delete</code> \u64CD\u4F5C\u5728\u5185\u90E8\u88AB\u89C6\u4E3A\u66F4\u65B0\uFF0C\u53EA\u4E0D\u8FC7\u4F1A\u5728\u8BB0\u5F55\u5934 <code>Record header</code> \u4E2D\u7684 <code>deleted_flag</code> \u5B57\u6BB5\u5C06\u5176\u6807\u8BB0\u4E3A\u5DF2\u5220\u9664</li><li><code>DB_ROLL_PTR\uFF087\u5B57\u8282\uFF09</code> \u56DE\u6EDA\u6307\u9488\uFF0C\u6307\u5411\u8BE5\u884C\u7684 <code>undo log</code> \u3002\u5982\u679C\u8BE5\u884C\u672A\u88AB\u66F4\u65B0\uFF0C\u5219\u4E3A\u7A7A</li><li><code>DB_ROW_ID\uFF086\u5B57\u8282\uFF09</code>\uFF1A\u5982\u679C\u6CA1\u6709\u8BBE\u7F6E\u4E3B\u952E\u4E14\u8BE5\u8868\u6CA1\u6709\u552F\u4E00\u975E\u7A7A\u7D22\u5F15\u65F6\uFF0C<code>InnoDB</code> \u4F1A\u4F7F\u7528\u8BE5 id \u6765\u751F\u6210\u805A\u7C07\u7D22\u5F15</li></ul><h3 id="readview" tabindex="-1"><a class="header-anchor" href="#readview" aria-hidden="true">#</a> ReadView</h3><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code>class ReadView <span class="token punctuation">{</span>
  <span class="token comment">/* ... */</span>
private<span class="token operator">:</span>
  <span class="token class-name">trx_id_t</span> m_low_limit_id<span class="token punctuation">;</span>      <span class="token comment">/* \u5927\u4E8E\u7B49\u4E8E\u8FD9\u4E2A ID \u7684\u4E8B\u52A1\u5747\u4E0D\u53EF\u89C1 */</span>

  <span class="token class-name">trx_id_t</span> m_up_limit_id<span class="token punctuation">;</span>       <span class="token comment">/* \u5C0F\u4E8E\u8FD9\u4E2A ID \u7684\u4E8B\u52A1\u5747\u53EF\u89C1 */</span>

  <span class="token class-name">trx_id_t</span> m_creator_trx_id<span class="token punctuation">;</span>    <span class="token comment">/* \u521B\u5EFA\u8BE5 Read View \u7684\u4E8B\u52A1ID */</span>

  <span class="token class-name">trx_id_t</span> m_low_limit_no<span class="token punctuation">;</span>      <span class="token comment">/* \u4E8B\u52A1 Number, \u5C0F\u4E8E\u8BE5 Number \u7684 Undo Logs \u5747\u53EF\u4EE5\u88AB Purge */</span>

  <span class="token class-name">ids_t</span> m_ids<span class="token punctuation">;</span>                  <span class="token comment">/* \u521B\u5EFA Read View \u65F6\u7684\u6D3B\u8DC3\u4E8B\u52A1\u5217\u8868 */</span>

  m_closed<span class="token punctuation">;</span>                     <span class="token comment">/* \u6807\u8BB0 Read View \u662F\u5426 close */</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),$={href:"https://github.com/facebook/mysql-8.0/blob/8.0/storage/innobase/include/read0types.h#L298",target:"_blank",rel:"noopener noreferrer"},ee=e("code",null,"Read View",-1),oe=o(" \u4E3B\u8981\u662F\u7528\u6765\u505A\u53EF\u89C1\u6027\u5224\u65AD\uFF0C\u91CC\u9762\u4FDD\u5B58\u4E86 \u201C\u5F53\u524D\u5BF9\u672C\u4E8B\u52A1\u4E0D\u53EF\u89C1\u7684\u5176\u4ED6\u6D3B\u8DC3\u4E8B\u52A1\u201D"),de=n("<p>\u4E3B\u8981\u6709\u4EE5\u4E0B\u5B57\u6BB5\uFF1A</p><ul><li><code>m_low_limit_id</code>\uFF1A\u76EE\u524D\u51FA\u73B0\u8FC7\u7684\u6700\u5927\u7684\u4E8B\u52A1 ID+1\uFF0C\u5373\u4E0B\u4E00\u4E2A\u5C06\u88AB\u5206\u914D\u7684\u4E8B\u52A1 ID\u3002\u5927\u4E8E\u7B49\u4E8E\u8FD9\u4E2A ID \u7684\u6570\u636E\u7248\u672C\u5747\u4E0D\u53EF\u89C1</li><li><code>m_up_limit_id</code>\uFF1A\u6D3B\u8DC3\u4E8B\u52A1\u5217\u8868 <code>m_ids</code> \u4E2D\u6700\u5C0F\u7684\u4E8B\u52A1 ID\uFF0C\u5982\u679C <code>m_ids</code> \u4E3A\u7A7A\uFF0C\u5219 <code>m_up_limit_id</code> \u4E3A <code>m_low_limit_id</code>\u3002\u5C0F\u4E8E\u8FD9\u4E2A ID \u7684\u6570\u636E\u7248\u672C\u5747\u53EF\u89C1</li><li><code>m_ids</code>\uFF1A<code>Read View</code> \u521B\u5EFA\u65F6\u5176\u4ED6\u672A\u63D0\u4EA4\u7684\u6D3B\u8DC3\u4E8B\u52A1 ID \u5217\u8868\u3002\u521B\u5EFA <code>Read View</code>\u65F6\uFF0C\u5C06\u5F53\u524D\u672A\u63D0\u4EA4\u4E8B\u52A1 ID \u8BB0\u5F55\u4E0B\u6765\uFF0C\u540E\u7EED\u5373\u4F7F\u5B83\u4EEC\u4FEE\u6539\u4E86\u8BB0\u5F55\u884C\u7684\u503C\uFF0C\u5BF9\u4E8E\u5F53\u524D\u4E8B\u52A1\u4E5F\u662F\u4E0D\u53EF\u89C1\u7684\u3002<code>m_ids</code> \u4E0D\u5305\u62EC\u5F53\u524D\u4E8B\u52A1\u81EA\u5DF1\u548C\u5DF2\u63D0\u4EA4\u7684\u4E8B\u52A1\uFF08\u6B63\u5728\u5185\u5B58\u4E2D\uFF09</li><li><code>m_creator_trx_id</code>\uFF1A\u521B\u5EFA\u8BE5 <code>Read View</code> \u7684\u4E8B\u52A1 ID</li></ul>",2),ce=e("strong",null,"\u4E8B\u52A1\u53EF\u89C1\u6027\u793A\u610F\u56FE",-1),ne=o("\uFF08"),ie={href:"https://leviathan.vip/2019/03/20/InnoDB%E7%9A%84%E4%BA%8B%E5%8A%A1%E5%88%86%E6%9E%90-MVCC/#MVCC-1",target:"_blank",rel:"noopener noreferrer"},te=o("\u56FE\u6E90"),se=o("\uFF09\uFF1A"),ae=n('<p><img src="'+l+'" alt="trans_visible" loading="lazy"></p><h3 id="undo-log" tabindex="-1"><a class="header-anchor" href="#undo-log" aria-hidden="true">#</a> undo-log</h3><p><code>undo log</code> \u4E3B\u8981\u6709\u4E24\u4E2A\u4F5C\u7528\uFF1A</p><ul><li>\u5F53\u4E8B\u52A1\u56DE\u6EDA\u65F6\u7528\u4E8E\u5C06\u6570\u636E\u6062\u590D\u5230\u4FEE\u6539\u524D\u7684\u6837\u5B50</li><li>\u53E6\u4E00\u4E2A\u4F5C\u7528\u662F <code>MVCC</code> \uFF0C\u5F53\u8BFB\u53D6\u8BB0\u5F55\u65F6\uFF0C\u82E5\u8BE5\u8BB0\u5F55\u88AB\u5176\u4ED6\u4E8B\u52A1\u5360\u7528\u6216\u5F53\u524D\u7248\u672C\u5BF9\u8BE5\u4E8B\u52A1\u4E0D\u53EF\u89C1\uFF0C\u5219\u53EF\u4EE5\u901A\u8FC7 <code>undo log</code> \u8BFB\u53D6\u4E4B\u524D\u7684\u7248\u672C\u6570\u636E\uFF0C\u4EE5\u6B64\u5B9E\u73B0\u975E\u9501\u5B9A\u8BFB</li></ul><p><strong>\u5728 <code>InnoDB</code> \u5B58\u50A8\u5F15\u64CE\u4E2D <code>undo log</code> \u5206\u4E3A\u4E24\u79CD\uFF1A <code>insert undo log</code> \u548C <code>update undo log</code>\uFF1A</strong></p><ol><li><strong><code>insert undo log</code></strong> \uFF1A\u6307\u5728 <code>insert</code> \u64CD\u4F5C\u4E2D\u4EA7\u751F\u7684 <code>undo log</code>\u3002\u56E0\u4E3A <code>insert</code> \u64CD\u4F5C\u7684\u8BB0\u5F55\u53EA\u5BF9\u4E8B\u52A1\u672C\u8EAB\u53EF\u89C1\uFF0C\u5BF9\u5176\u4ED6\u4E8B\u52A1\u4E0D\u53EF\u89C1\uFF0C\u6545\u8BE5 <code>undo log</code> \u53EF\u4EE5\u5728\u4E8B\u52A1\u63D0\u4EA4\u540E\u76F4\u63A5\u5220\u9664\u3002\u4E0D\u9700\u8981\u8FDB\u884C <code>purge</code> \u64CD\u4F5C</li></ol><p><strong><code>insert</code> \u65F6\u7684\u6570\u636E\u521D\u59CB\u72B6\u6001\uFF1A</strong></p><p><img src="'+_+'" alt="" loading="lazy"></p><ol start="2"><li><strong><code>update undo log</code></strong> \uFF1A<code>update</code> \u6216 <code>delete</code> \u64CD\u4F5C\u4E2D\u4EA7\u751F\u7684 <code>undo log</code>\u3002\u8BE5 <code>undo log</code>\u53EF\u80FD\u9700\u8981\u63D0\u4F9B <code>MVCC</code> \u673A\u5236\uFF0C\u56E0\u6B64\u4E0D\u80FD\u5728\u4E8B\u52A1\u63D0\u4EA4\u65F6\u5C31\u8FDB\u884C\u5220\u9664\u3002\u63D0\u4EA4\u65F6\u653E\u5165 <code>undo log</code> \u94FE\u8868\uFF0C\u7B49\u5F85 <code>purge\u7EBF\u7A0B</code> \u8FDB\u884C\u6700\u540E\u7684\u5220\u9664</li></ol><p><strong>\u6570\u636E\u7B2C\u4E00\u6B21\u88AB\u4FEE\u6539\u65F6\uFF1A</strong></p><p><img src="'+r+'" alt="" loading="lazy"></p><p><strong>\u6570\u636E\u7B2C\u4E8C\u6B21\u88AB\u4FEE\u6539\u65F6\uFF1A</strong></p><p><img src="'+p+'" alt="" loading="lazy"></p><p>\u4E0D\u540C\u4E8B\u52A1\u6216\u8005\u76F8\u540C\u4E8B\u52A1\u7684\u5BF9\u540C\u4E00\u8BB0\u5F55\u884C\u7684\u4FEE\u6539\uFF0C\u4F1A\u4F7F\u8BE5\u8BB0\u5F55\u884C\u7684 <code>undo log</code> \u6210\u4E3A\u4E00\u6761\u94FE\u8868\uFF0C\u94FE\u9996\u5C31\u662F\u6700\u65B0\u7684\u8BB0\u5F55\uFF0C\u94FE\u5C3E\u5C31\u662F\u6700\u65E9\u7684\u65E7\u8BB0\u5F55\u3002</p><h3 id="\u6570\u636E\u53EF\u89C1\u6027\u7B97\u6CD5" tabindex="-1"><a class="header-anchor" href="#\u6570\u636E\u53EF\u89C1\u6027\u7B97\u6CD5" aria-hidden="true">#</a> \u6570\u636E\u53EF\u89C1\u6027\u7B97\u6CD5</h3><p>\u5728 <code>InnoDB</code> \u5B58\u50A8\u5F15\u64CE\u4E2D\uFF0C\u521B\u5EFA\u4E00\u4E2A\u65B0\u4E8B\u52A1\u540E\uFF0C\u6267\u884C\u6BCF\u4E2A <code>select</code> \u8BED\u53E5\u524D\uFF0C\u90FD\u4F1A\u521B\u5EFA\u4E00\u4E2A\u5FEB\u7167\uFF08Read View\uFF09\uFF0C<strong>\u5FEB\u7167\u4E2D\u4FDD\u5B58\u4E86\u5F53\u524D\u6570\u636E\u5E93\u7CFB\u7EDF\u4E2D\u6B63\u5904\u4E8E\u6D3B\u8DC3\uFF08\u6CA1\u6709 commit\uFF09\u7684\u4E8B\u52A1\u7684 ID \u53F7</strong>\u3002\u5176\u5B9E\u7B80\u5355\u7684\u8BF4\u4FDD\u5B58\u7684\u662F\u7CFB\u7EDF\u4E2D\u5F53\u524D\u4E0D\u5E94\u8BE5\u88AB\u672C\u4E8B\u52A1\u770B\u5230\u7684\u5176\u4ED6\u4E8B\u52A1 ID \u5217\u8868\uFF08\u5373 m_ids\uFF09\u3002\u5F53\u7528\u6237\u5728\u8FD9\u4E2A\u4E8B\u52A1\u4E2D\u8981\u8BFB\u53D6\u67D0\u4E2A\u8BB0\u5F55\u884C\u7684\u65F6\u5019\uFF0C<code>InnoDB</code> \u4F1A\u5C06\u8BE5\u8BB0\u5F55\u884C\u7684 <code>DB_TRX_ID</code> \u4E0E <code>Read View</code> \u4E2D\u7684\u4E00\u4E9B\u53D8\u91CF\u53CA\u5F53\u524D\u4E8B\u52A1 ID \u8FDB\u884C\u6BD4\u8F83\uFF0C\u5224\u65AD\u662F\u5426\u6EE1\u8DB3\u53EF\u89C1\u6027\u6761\u4EF6</p>',16),le={href:"https://github.com/facebook/mysql-8.0/blob/8.0/storage/innobase/include/read0types.h#L161",target:"_blank",rel:"noopener noreferrer"},_e=o("\u5177\u4F53\u7684\u6BD4\u8F83\u7B97\u6CD5"),re=o("\u5982\u4E0B("),pe={href:"https://leviathan.vip/2019/03/20/InnoDB%E7%9A%84%E4%BA%8B%E5%8A%A1%E5%88%86%E6%9E%90-MVCC/#MVCC-1",target:"_blank",rel:"noopener noreferrer"},me=o("\u56FE\u6E90"),he=o(")\uFF1A"),ue=n('<p><img src="'+m+'" alt="" loading="lazy"></p><ol><li><p>\u5982\u679C\u8BB0\u5F55 DB_TRX_ID &lt; m_up_limit_id\uFF0C\u90A3\u4E48\u8868\u660E\u6700\u65B0\u4FEE\u6539\u8BE5\u884C\u7684\u4E8B\u52A1\uFF08DB_TRX_ID\uFF09\u5728\u5F53\u524D\u4E8B\u52A1\u521B\u5EFA\u5FEB\u7167\u4E4B\u524D\u5C31\u63D0\u4EA4\u4E86\uFF0C\u6240\u4EE5\u8BE5\u8BB0\u5F55\u884C\u7684\u503C\u5BF9\u5F53\u524D\u4E8B\u52A1\u662F\u53EF\u89C1\u7684</p></li><li><p>\u5982\u679C DB_TRX_ID &gt;= m_low_limit_id\uFF0C\u90A3\u4E48\u8868\u660E\u6700\u65B0\u4FEE\u6539\u8BE5\u884C\u7684\u4E8B\u52A1\uFF08DB_TRX_ID\uFF09\u5728\u5F53\u524D\u4E8B\u52A1\u521B\u5EFA\u5FEB\u7167\u4E4B\u540E\u624D\u4FEE\u6539\u8BE5\u884C\uFF0C\u6240\u4EE5\u8BE5\u8BB0\u5F55\u884C\u7684\u503C\u5BF9\u5F53\u524D\u4E8B\u52A1\u4E0D\u53EF\u89C1\u3002\u8DF3\u5230\u6B65\u9AA4 5</p></li><li><p>m_ids \u4E3A\u7A7A\uFF0C\u5219\u8868\u660E\u5728\u5F53\u524D\u4E8B\u52A1\u521B\u5EFA\u5FEB\u7167\u4E4B\u524D\uFF0C\u4FEE\u6539\u8BE5\u884C\u7684\u4E8B\u52A1\u5C31\u5DF2\u7ECF\u63D0\u4EA4\u4E86\uFF0C\u6240\u4EE5\u8BE5\u8BB0\u5F55\u884C\u7684\u503C\u5BF9\u5F53\u524D\u4E8B\u52A1\u662F\u53EF\u89C1\u7684</p></li><li><p>\u5982\u679C m_up_limit_id &lt;= DB_TRX_ID &lt; m_low_limit_id\uFF0C\u8868\u660E\u6700\u65B0\u4FEE\u6539\u8BE5\u884C\u7684\u4E8B\u52A1\uFF08DB_TRX_ID\uFF09\u5728\u5F53\u524D\u4E8B\u52A1\u521B\u5EFA\u5FEB\u7167\u7684\u65F6\u5019\u53EF\u80FD\u5904\u4E8E\u201C\u6D3B\u52A8\u72B6\u6001\u201D\u6216\u8005\u201C\u5DF2\u63D0\u4EA4\u72B6\u6001\u201D\uFF1B\u6240\u4EE5\u5C31\u8981\u5BF9\u6D3B\u8DC3\u4E8B\u52A1\u5217\u8868 m_ids \u8FDB\u884C\u67E5\u627E\uFF08\u6E90\u7801\u4E2D\u662F\u7528\u7684\u4E8C\u5206\u67E5\u627E\uFF0C\u56E0\u4E3A\u662F\u6709\u5E8F\u7684\uFF09</p><ul><li><p>\u5982\u679C\u5728\u6D3B\u8DC3\u4E8B\u52A1\u5217\u8868 m_ids \u4E2D\u80FD\u627E\u5230 DB_TRX_ID\uFF0C\u8868\u660E\uFF1A\u2460 \u5728\u5F53\u524D\u4E8B\u52A1\u521B\u5EFA\u5FEB\u7167\u524D\uFF0C\u8BE5\u8BB0\u5F55\u884C\u7684\u503C\u88AB\u4E8B\u52A1 ID \u4E3A DB_TRX_ID \u7684\u4E8B\u52A1\u4FEE\u6539\u4E86\uFF0C\u4F46\u6CA1\u6709\u63D0\u4EA4\uFF1B\u6216\u8005 \u2461 \u5728\u5F53\u524D\u4E8B\u52A1\u521B\u5EFA\u5FEB\u7167\u540E\uFF0C\u8BE5\u8BB0\u5F55\u884C\u7684\u503C\u88AB\u4E8B\u52A1 ID \u4E3A DB_TRX_ID \u7684\u4E8B\u52A1\u4FEE\u6539\u4E86\u3002\u8FD9\u4E9B\u60C5\u51B5\u4E0B\uFF0C\u8FD9\u4E2A\u8BB0\u5F55\u884C\u7684\u503C\u5BF9\u5F53\u524D\u4E8B\u52A1\u90FD\u662F\u4E0D\u53EF\u89C1\u7684\u3002\u8DF3\u5230\u6B65\u9AA4 5</p></li><li><p>\u5728\u6D3B\u8DC3\u4E8B\u52A1\u5217\u8868\u4E2D\u627E\u4E0D\u5230\uFF0C\u5219\u8868\u660E\u201Cid \u4E3A trx_id \u7684\u4E8B\u52A1\u201D\u5728\u4FEE\u6539\u201C\u8BE5\u8BB0\u5F55\u884C\u7684\u503C\u201D\u540E\uFF0C\u5728\u201C\u5F53\u524D\u4E8B\u52A1\u201D\u521B\u5EFA\u5FEB\u7167\u524D\u5C31\u5DF2\u7ECF\u63D0\u4EA4\u4E86\uFF0C\u6240\u4EE5\u8BB0\u5F55\u884C\u5BF9\u5F53\u524D\u4E8B\u52A1\u53EF\u89C1</p></li></ul></li><li><p>\u5728\u8BE5\u8BB0\u5F55\u884C\u7684 DB_ROLL_PTR \u6307\u9488\u6240\u6307\u5411\u7684 <code>undo log</code> \u53D6\u51FA\u5FEB\u7167\u8BB0\u5F55\uFF0C\u7528\u5FEB\u7167\u8BB0\u5F55\u7684 DB_TRX_ID \u8DF3\u5230\u6B65\u9AA4 1 \u91CD\u65B0\u5F00\u59CB\u5224\u65AD\uFF0C\u76F4\u5230\u627E\u5230\u6EE1\u8DB3\u7684\u5FEB\u7167\u7248\u672C\u6216\u8FD4\u56DE\u7A7A</p></li></ol><h2 id="rc-\u548C-rr-\u9694\u79BB\u7EA7\u522B\u4E0B-mvcc-\u7684\u5DEE\u5F02" tabindex="-1"><a class="header-anchor" href="#rc-\u548C-rr-\u9694\u79BB\u7EA7\u522B\u4E0B-mvcc-\u7684\u5DEE\u5F02" aria-hidden="true">#</a> RC \u548C RR \u9694\u79BB\u7EA7\u522B\u4E0B MVCC \u7684\u5DEE\u5F02</h2><p>\u5728\u4E8B\u52A1\u9694\u79BB\u7EA7\u522B <code>RC</code> \u548C <code>RR</code> \uFF08InnoDB \u5B58\u50A8\u5F15\u64CE\u7684\u9ED8\u8BA4\u4E8B\u52A1\u9694\u79BB\u7EA7\u522B\uFF09\u4E0B\uFF0C<code>InnoDB</code> \u5B58\u50A8\u5F15\u64CE\u4F7F\u7528 <code>MVCC</code>\uFF08\u975E\u9501\u5B9A\u4E00\u81F4\u6027\u8BFB\uFF09\uFF0C\u4F46\u5B83\u4EEC\u751F\u6210 <code>Read View</code> \u7684\u65F6\u673A\u5374\u4E0D\u540C</p><ul><li>\u5728 RC \u9694\u79BB\u7EA7\u522B\u4E0B\u7684 <strong><code>\u6BCF\u6B21select</code></strong> \u67E5\u8BE2\u524D\u90FD\u751F\u6210\u4E00\u4E2A<code>Read View</code> (m_ids \u5217\u8868)</li><li>\u5728 RR \u9694\u79BB\u7EA7\u522B\u4E0B\u53EA\u5728\u4E8B\u52A1\u5F00\u59CB\u540E <strong><code>\u7B2C\u4E00\u6B21select</code></strong> \u6570\u636E\u524D\u751F\u6210\u4E00\u4E2A<code>Read View</code>\uFF08m_ids \u5217\u8868\uFF09</li></ul><h2 id="mvcc-\u89E3\u51B3\u4E0D\u53EF\u91CD\u590D\u8BFB\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#mvcc-\u89E3\u51B3\u4E0D\u53EF\u91CD\u590D\u8BFB\u95EE\u9898" aria-hidden="true">#</a> MVCC \u89E3\u51B3\u4E0D\u53EF\u91CD\u590D\u8BFB\u95EE\u9898</h2><p>\u867D\u7136 RC \u548C RR \u90FD\u901A\u8FC7 <code>MVCC</code> \u6765\u8BFB\u53D6\u5FEB\u7167\u6570\u636E\uFF0C\u4F46\u7531\u4E8E <strong>\u751F\u6210 Read View \u65F6\u673A\u4E0D\u540C</strong>\uFF0C\u4ECE\u800C\u5728 RR \u7EA7\u522B\u4E0B\u5B9E\u73B0\u53EF\u91CD\u590D\u8BFB</p><p>\u4E3E\u4E2A\u4F8B\u5B50\uFF1A</p><p><img src="'+h+'" alt="" loading="lazy"></p><h3 id="\u5728-rc-\u4E0B-readview-\u751F\u6210\u60C5\u51B5" tabindex="-1"><a class="header-anchor" href="#\u5728-rc-\u4E0B-readview-\u751F\u6210\u60C5\u51B5" aria-hidden="true">#</a> \u5728 RC \u4E0B ReadView \u751F\u6210\u60C5\u51B5</h3><p><strong>1. \u5047\u8BBE\u65F6\u95F4\u7EBF\u6765\u5230 T4 \uFF0C\u90A3\u4E48\u6B64\u65F6\u6570\u636E\u884C id = 1 \u7684\u7248\u672C\u94FE\u4E3A\uFF1A</strong></p><p><img src="'+u+'" alt="" loading="lazy"></p><p>\u7531\u4E8E RC \u7EA7\u522B\u4E0B\u6BCF\u6B21\u67E5\u8BE2\u90FD\u4F1A\u751F\u6210<code>Read View</code> \uFF0C\u5E76\u4E14\u4E8B\u52A1 101\u3001102 \u5E76\u672A\u63D0\u4EA4\uFF0C\u6B64\u65F6 <code>103</code> \u4E8B\u52A1\u751F\u6210\u7684 <code>Read View</code> \u4E2D\u6D3B\u8DC3\u7684\u4E8B\u52A1 <strong><code>m_ids</code> \u4E3A\uFF1A[101,102]</strong> \uFF0C<code>m_low_limit_id</code>\u4E3A\uFF1A104\uFF0C<code>m_up_limit_id</code>\u4E3A\uFF1A101\uFF0C<code>m_creator_trx_id</code> \u4E3A\uFF1A103</p><ul><li>\u6B64\u65F6\u6700\u65B0\u8BB0\u5F55\u7684 <code>DB_TRX_ID</code> \u4E3A 101\uFF0Cm_up_limit_id &lt;= 101 &lt; m_low_limit_id\uFF0C\u6240\u4EE5\u8981\u5728 <code>m_ids</code> \u5217\u8868\u4E2D\u67E5\u627E\uFF0C\u53D1\u73B0 <code>DB_TRX_ID</code> \u5B58\u5728\u5217\u8868\u4E2D\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u8BB0\u5F55\u4E0D\u53EF\u89C1</li><li>\u6839\u636E <code>DB_ROLL_PTR</code> \u627E\u5230 <code>undo log</code> \u4E2D\u7684\u4E0A\u4E00\u7248\u672C\u8BB0\u5F55\uFF0C\u4E0A\u4E00\u6761\u8BB0\u5F55\u7684 <code>DB_TRX_ID</code> \u8FD8\u662F 101\uFF0C\u4E0D\u53EF\u89C1</li><li>\u7EE7\u7EED\u627E\u4E0A\u4E00\u6761 <code>DB_TRX_ID</code>\u4E3A 1\uFF0C\u6EE1\u8DB3 1 &lt; m_up_limit_id\uFF0C\u53EF\u89C1\uFF0C\u6240\u4EE5\u4E8B\u52A1 103 \u67E5\u8BE2\u5230\u6570\u636E\u4E3A <code>name = \u83DC\u82B1</code></li></ul><p><strong>2. \u65F6\u95F4\u7EBF\u6765\u5230 T6 \uFF0C\u6570\u636E\u7684\u7248\u672C\u94FE\u4E3A\uFF1A</strong></p><p><img src="'+g+'" alt="" loading="lazy"></p><p>\u56E0\u4E3A\u5728 RC \u7EA7\u522B\u4E0B\uFF0C\u91CD\u65B0\u751F\u6210 <code>Read View</code>\uFF0C\u8FD9\u65F6\u4E8B\u52A1 101 \u5DF2\u7ECF\u63D0\u4EA4\uFF0C102 \u5E76\u672A\u63D0\u4EA4\uFF0C\u6240\u4EE5\u6B64\u65F6 <code>Read View</code> \u4E2D\u6D3B\u8DC3\u7684\u4E8B\u52A1 <strong><code>m_ids</code>\uFF1A[102]</strong> \uFF0C<code>m_low_limit_id</code>\u4E3A\uFF1A104\uFF0C<code>m_up_limit_id</code>\u4E3A\uFF1A102\uFF0C<code>m_creator_trx_id</code>\u4E3A\uFF1A103</p><ul><li><p>\u6B64\u65F6\u6700\u65B0\u8BB0\u5F55\u7684 <code>DB_TRX_ID</code> \u4E3A 102\uFF0Cm_up_limit_id &lt;= 102 &lt; m_low_limit_id\uFF0C\u6240\u4EE5\u8981\u5728 <code>m_ids</code> \u5217\u8868\u4E2D\u67E5\u627E\uFF0C\u53D1\u73B0 <code>DB_TRX_ID</code> \u5B58\u5728\u5217\u8868\u4E2D\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u8BB0\u5F55\u4E0D\u53EF\u89C1</p></li><li><p>\u6839\u636E <code>DB_ROLL_PTR</code> \u627E\u5230 <code>undo log</code> \u4E2D\u7684\u4E0A\u4E00\u7248\u672C\u8BB0\u5F55\uFF0C\u4E0A\u4E00\u6761\u8BB0\u5F55\u7684 <code>DB_TRX_ID</code> \u4E3A 101\uFF0C\u6EE1\u8DB3 101 &lt; m_up_limit_id\uFF0C\u8BB0\u5F55\u53EF\u89C1\uFF0C\u6240\u4EE5\u5728 <code>T6</code> \u65F6\u95F4\u70B9\u67E5\u8BE2\u5230\u6570\u636E\u4E3A <code>name = \u674E\u56DB</code>\uFF0C\u4E0E\u65F6\u95F4 T4 \u67E5\u8BE2\u5230\u7684\u7ED3\u679C\u4E0D\u4E00\u81F4\uFF0C\u4E0D\u53EF\u91CD\u590D\u8BFB\uFF01</p></li></ul><p><strong>3. \u65F6\u95F4\u7EBF\u6765\u5230 T9 \uFF0C\u6570\u636E\u7684\u7248\u672C\u94FE\u4E3A\uFF1A</strong></p><p><img src="'+R+'" alt="" loading="lazy"></p><p>\u91CD\u65B0\u751F\u6210 <code>Read View</code>\uFF0C \u8FD9\u65F6\u4E8B\u52A1 101 \u548C 102 \u90FD\u5DF2\u7ECF\u63D0\u4EA4\uFF0C\u6240\u4EE5 <strong>m_ids</strong> \u4E3A\u7A7A\uFF0C\u5219 m_up_limit_id = m_low_limit_id = 104\uFF0C\u6700\u65B0\u7248\u672C\u4E8B\u52A1 ID \u4E3A 102\uFF0C\u6EE1\u8DB3 102 &lt; m_low_limit_id\uFF0C\u53EF\u89C1\uFF0C\u67E5\u8BE2\u7ED3\u679C\u4E3A <code>name = \u8D75\u516D</code></p><blockquote><p><strong>\u603B\u7ED3\uFF1A</strong> <strong>\u5728 RC \u9694\u79BB\u7EA7\u522B\u4E0B\uFF0C\u4E8B\u52A1\u5728\u6BCF\u6B21\u67E5\u8BE2\u5F00\u59CB\u65F6\u90FD\u4F1A\u751F\u6210\u5E76\u8BBE\u7F6E\u65B0\u7684 Read View\uFF0C\u6240\u4EE5\u5BFC\u81F4\u4E0D\u53EF\u91CD\u590D\u8BFB</strong></p></blockquote><h3 id="\u5728-rr-\u4E0B-readview-\u751F\u6210\u60C5\u51B5" tabindex="-1"><a class="header-anchor" href="#\u5728-rr-\u4E0B-readview-\u751F\u6210\u60C5\u51B5" aria-hidden="true">#</a> \u5728 RR \u4E0B ReadView \u751F\u6210\u60C5\u51B5</h3><p>\u5728\u53EF\u91CD\u590D\u8BFB\u7EA7\u522B\u4E0B\uFF0C\u53EA\u4F1A\u5728\u4E8B\u52A1\u5F00\u59CB\u540E\u7B2C\u4E00\u6B21\u8BFB\u53D6\u6570\u636E\u65F6\u751F\u6210\u4E00\u4E2A Read View\uFF08m_ids \u5217\u8868\uFF09</p><p><strong>1. \u5728 T4 \u60C5\u51B5\u4E0B\u7684\u7248\u672C\u94FE\u4E3A\uFF1A</strong></p><p><img src="'+b+'" alt="" loading="lazy"></p><p>\u5728\u5F53\u524D\u6267\u884C <code>select</code> \u8BED\u53E5\u65F6\u751F\u6210\u4E00\u4E2A <code>Read View</code>\uFF0C\u6B64\u65F6 <strong><code>m_ids</code>\uFF1A[101,102]</strong> \uFF0C<code>m_low_limit_id</code>\u4E3A\uFF1A104\uFF0C<code>m_up_limit_id</code>\u4E3A\uFF1A101\uFF0C<code>m_creator_trx_id</code> \u4E3A\uFF1A103</p><p>\u6B64\u65F6\u548C RC \u7EA7\u522B\u4E0B\u4E00\u6837\uFF1A</p><ul><li>\u6700\u65B0\u8BB0\u5F55\u7684 <code>DB_TRX_ID</code> \u4E3A 101\uFF0Cm_up_limit_id &lt;= 101 &lt; m_low_limit_id\uFF0C\u6240\u4EE5\u8981\u5728 <code>m_ids</code> \u5217\u8868\u4E2D\u67E5\u627E\uFF0C\u53D1\u73B0 <code>DB_TRX_ID</code> \u5B58\u5728\u5217\u8868\u4E2D\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u8BB0\u5F55\u4E0D\u53EF\u89C1</li><li>\u6839\u636E <code>DB_ROLL_PTR</code> \u627E\u5230 <code>undo log</code> \u4E2D\u7684\u4E0A\u4E00\u7248\u672C\u8BB0\u5F55\uFF0C\u4E0A\u4E00\u6761\u8BB0\u5F55\u7684 <code>DB_TRX_ID</code> \u8FD8\u662F 101\uFF0C\u4E0D\u53EF\u89C1</li><li>\u7EE7\u7EED\u627E\u4E0A\u4E00\u6761 <code>DB_TRX_ID</code>\u4E3A 1\uFF0C\u6EE1\u8DB3 1 &lt; m_up_limit_id\uFF0C\u53EF\u89C1\uFF0C\u6240\u4EE5\u4E8B\u52A1 103 \u67E5\u8BE2\u5230\u6570\u636E\u4E3A <code>name = \u83DC\u82B1</code></li></ul><p><strong>2. \u65F6\u95F4\u70B9 T6 \u60C5\u51B5\u4E0B\uFF1A</strong></p><p><img src="'+D+'" alt="" loading="lazy"></p><p>\u5728 RR \u7EA7\u522B\u4E0B\u53EA\u4F1A\u751F\u6210\u4E00\u6B21<code>Read View</code>\uFF0C\u6240\u4EE5\u6B64\u65F6\u4F9D\u7136\u6CBF\u7528 <strong><code>m_ids</code> \uFF1A[101,102]</strong> \uFF0C<code>m_low_limit_id</code>\u4E3A\uFF1A104\uFF0C<code>m_up_limit_id</code>\u4E3A\uFF1A101\uFF0C<code>m_creator_trx_id</code> \u4E3A\uFF1A103</p><ul><li><p>\u6700\u65B0\u8BB0\u5F55\u7684 <code>DB_TRX_ID</code> \u4E3A 102\uFF0Cm_up_limit_id &lt;= 102 &lt; m_low_limit_id\uFF0C\u6240\u4EE5\u8981\u5728 <code>m_ids</code> \u5217\u8868\u4E2D\u67E5\u627E\uFF0C\u53D1\u73B0 <code>DB_TRX_ID</code> \u5B58\u5728\u5217\u8868\u4E2D\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u8BB0\u5F55\u4E0D\u53EF\u89C1</p></li><li><p>\u6839\u636E <code>DB_ROLL_PTR</code> \u627E\u5230 <code>undo log</code> \u4E2D\u7684\u4E0A\u4E00\u7248\u672C\u8BB0\u5F55\uFF0C\u4E0A\u4E00\u6761\u8BB0\u5F55\u7684 <code>DB_TRX_ID</code> \u4E3A 101\uFF0C\u4E0D\u53EF\u89C1</p></li><li><p>\u7EE7\u7EED\u6839\u636E <code>DB_ROLL_PTR</code> \u627E\u5230 <code>undo log</code> \u4E2D\u7684\u4E0A\u4E00\u7248\u672C\u8BB0\u5F55\uFF0C\u4E0A\u4E00\u6761\u8BB0\u5F55\u7684 <code>DB_TRX_ID</code> \u8FD8\u662F 101\uFF0C\u4E0D\u53EF\u89C1</p></li><li><p>\u7EE7\u7EED\u627E\u4E0A\u4E00\u6761 <code>DB_TRX_ID</code>\u4E3A 1\uFF0C\u6EE1\u8DB3 1 &lt; m_up_limit_id\uFF0C\u53EF\u89C1\uFF0C\u6240\u4EE5\u4E8B\u52A1 103 \u67E5\u8BE2\u5230\u6570\u636E\u4E3A <code>name = \u83DC\u82B1</code></p></li></ul><p><strong>3. \u65F6\u95F4\u70B9 T9 \u60C5\u51B5\u4E0B\uFF1A</strong></p><p><img src="'+f+'" alt="" loading="lazy"></p><p>\u6B64\u65F6\u60C5\u51B5\u8DDF T6 \u5B8C\u5168\u4E00\u6837\uFF0C\u7531\u4E8E\u5DF2\u7ECF\u751F\u6210\u4E86 <code>Read View</code>\uFF0C\u6B64\u65F6\u4F9D\u7136\u6CBF\u7528 <strong><code>m_ids</code> \uFF1A[101,102]</strong> \uFF0C\u6240\u4EE5\u67E5\u8BE2\u7ED3\u679C\u4F9D\u7136\u662F <code>name = \u83DC\u82B1</code></p><h2 id="mvcc\u2795next-key-lock-\u9632\u6B62\u5E7B\u8BFB" tabindex="-1"><a class="header-anchor" href="#mvcc\u2795next-key-lock-\u9632\u6B62\u5E7B\u8BFB" aria-hidden="true">#</a> MVCC\u2795Next-key-Lock \u9632\u6B62\u5E7B\u8BFB</h2><p><code>InnoDB</code>\u5B58\u50A8\u5F15\u64CE\u5728 RR \u7EA7\u522B\u4E0B\u901A\u8FC7 <code>MVCC</code>\u548C <code>Next-key Lock</code> \u6765\u89E3\u51B3\u5E7B\u8BFB\u95EE\u9898\uFF1A</p><p><strong>1\u3001\u6267\u884C\u666E\u901A <code>select</code>\uFF0C\u6B64\u65F6\u4F1A\u4EE5 <code>MVCC</code> \u5FEB\u7167\u8BFB\u7684\u65B9\u5F0F\u8BFB\u53D6\u6570\u636E</strong></p><p>\u5728\u5FEB\u7167\u8BFB\u7684\u60C5\u51B5\u4E0B\uFF0CRR \u9694\u79BB\u7EA7\u522B\u53EA\u4F1A\u5728\u4E8B\u52A1\u5F00\u542F\u540E\u7684\u7B2C\u4E00\u6B21\u67E5\u8BE2\u751F\u6210 <code>Read View</code> \uFF0C\u5E76\u4F7F\u7528\u81F3\u4E8B\u52A1\u63D0\u4EA4\u3002\u6240\u4EE5\u5728\u751F\u6210 <code>Read View</code> \u4E4B\u540E\u5176\u5B83\u4E8B\u52A1\u6240\u505A\u7684\u66F4\u65B0\u3001\u63D2\u5165\u8BB0\u5F55\u7248\u672C\u5BF9\u5F53\u524D\u4E8B\u52A1\u5E76\u4E0D\u53EF\u89C1\uFF0C\u5B9E\u73B0\u4E86\u53EF\u91CD\u590D\u8BFB\u548C\u9632\u6B62\u5FEB\u7167\u8BFB\u4E0B\u7684 \u201C\u5E7B\u8BFB\u201D</p><p><strong>2\u3001\u6267\u884C select...for update/lock in share mode\u3001insert\u3001update\u3001delete \u7B49\u5F53\u524D\u8BFB</strong></p>',41),ge=o("\u5728\u5F53\u524D\u8BFB\u4E0B\uFF0C\u8BFB\u53D6\u7684\u90FD\u662F\u6700\u65B0\u7684\u6570\u636E\uFF0C\u5982\u679C\u5176\u5B83\u4E8B\u52A1\u6709\u63D2\u5165\u65B0\u7684\u8BB0\u5F55\uFF0C\u5E76\u4E14\u521A\u597D\u5728\u5F53\u524D\u4E8B\u52A1\u67E5\u8BE2\u8303\u56F4\u5185\uFF0C\u5C31\u4F1A\u4EA7\u751F\u5E7B\u8BFB\uFF01"),Re=e("code",null,"InnoDB",-1),be=o(" \u4F7F\u7528 "),De={href:"https://dev.mysql.com/doc/refman/5.7/en/innodb-locking.html#innodb-next-key-locks",target:"_blank",rel:"noopener noreferrer"},fe=o("Next-key Lock"),ve=o(" \u6765\u9632\u6B62\u8FD9\u79CD\u60C5\u51B5\u3002\u5F53\u6267\u884C\u5F53\u524D\u8BFB\u65F6\uFF0C\u4F1A\u9501\u5B9A\u8BFB\u53D6\u5230\u7684\u8BB0\u5F55\u7684\u540C\u65F6\uFF0C\u9501\u5B9A\u5B83\u4EEC\u7684\u95F4\u9699\uFF0C\u9632\u6B62\u5176\u5B83\u4E8B\u52A1\u5728\u67E5\u8BE2\u8303\u56F4\u5185\u63D2\u5165\u6570\u636E\u3002\u53EA\u8981\u6211\u4E0D\u8BA9\u4F60\u63D2\u5165\uFF0C\u5C31\u4E0D\u4F1A\u53D1\u751F\u5E7B\u8BFB"),Ie=e("h2",{id:"\u53C2\u8003",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u53C2\u8003","aria-hidden":"true"},"#"),o(" \u53C2\u8003")],-1),Be=e("li",null,[e("strong",null,"\u300AMySQL \u6280\u672F\u5185\u5E55 InnoDB \u5B58\u50A8\u5F15\u64CE\u7B2C 2 \u7248\u300B")],-1),ke={href:"https://tech.meituan.com/2014/08/20/innodb-lock.html",target:"_blank",rel:"noopener noreferrer"},Ve=o("Innodb \u4E2D\u7684\u4E8B\u52A1\u9694\u79BB\u7EA7\u522B\u548C\u9501\u7684\u5173\u7CFB"),we={href:"https://blog.csdn.net/qq_35190492/article/details/109044141",target:"_blank",rel:"noopener noreferrer"},Ce=o("MySQL \u4E8B\u52A1\u4E0E MVCC \u5982\u4F55\u5B9E\u73B0\u7684\u9694\u79BB\u7EA7\u522B"),Te={href:"https://leviathan.vip/2019/03/20/InnoDB%E7%9A%84%E4%BA%8B%E5%8A%A1%E5%88%86%E6%9E%90-MVCC/",target:"_blank",rel:"noopener noreferrer"},xe=o("InnoDB \u4E8B\u52A1\u5206\u6790-MVCC");function Xe(ye,Le){const d=a("ExternalLinkIcon");return t(),s("div",null,[I,B,e("p",null,[k,e("a",V,[w,C,c(d)]),T]),e("p",null,[x,X,y,e("a",L,[E,c(d)]),M,A,z,q,N,O,P]),S,e("p",null,[Q,e("a",U,[W,c(d)])]),j,e("p",null,[F,G,H,e("a",J,[K,c(d)]),Y]),Z,e("p",null,[e("a",$,[ee,c(d)]),oe]),de,e("p",null,[ce,ne,e("a",ie,[te,c(d)]),se]),ae,e("p",null,[e("a",le,[_e,c(d)]),re,e("a",pe,[me,c(d)]),he]),ue,e("p",null,[ge,Re,be,e("a",De,[fe,c(d)]),ve]),Ie,e("ul",null,[Be,e("li",null,[e("a",ke,[Ve,c(d)])]),e("li",null,[e("a",we,[Ce,c(d)])]),e("li",null,[e("a",Te,[xe,c(d)])])])])}var Ae=i(v,[["render",Xe],["__file","innodb-implementation-of-mvcc.html.vue"]]);export{Ae as default};
