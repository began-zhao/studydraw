import{defineComponent as e,ref as t,computed as s,onMounted as a,h as l}from"vue";import"vuepress-shared/lib/client";import"balloon-css/balloon.css";import"../styles/code-demo.scss";const n=CODE_DEMO_OPTIONS,o={html:{types:["html","slim","haml","md","markdown","vue"],map:{html:"none",vue:"none",md:"markdown"}},js:{types:["js","javascript","coffee","coffeescript","ts","typescript","ls","livescript"],map:{js:"none",javascript:"none",coffee:"coffeescript",ls:"livescript",ts:"typescript"}},css:{types:["css","less","sass","scss","stylus","styl"],map:{css:"none",styl:"stylus"}}},r=e=>({...n,...e,jsLib:Array.from(new Set([...n.jsLib||[],...e.jsLib||[]])),cssLib:Array.from(new Set([...n.cssLib||[],...e.cssLib||[]]))}),i=(e,t)=>{if(void 0!==e[t])return e[t];const s=new Promise((e=>{const s=document.createElement("script");s.src=t,document.querySelector("body")?.appendChild(s),s.onload=()=>{e()}}));return e[t]=s,s},c=(e,t)=>{if(t.css&&Array.from(e.childNodes).every((e=>"STYLE"!==e.nodeName))){const s=((e,t,s)=>{const a=document.createElement(e);return t&&Object.keys(t).forEach((e=>{if(e.indexOf("data"))a[e]=t[e];else{const s=e.replace("data","");a.dataset[s]=t[e]}})),s&&s.forEach((e=>{a.appendChild(e)})),a})("style",{innerHTML:t.css});e.appendChild(s)}},p=e=>e.replace(/<br \/>/g,"<br>").replace(/<((\S+)[^<]*?)\s+\/>/g,"<$1></$2>"),d=e=>`<div id="app">\n${p(e)}\n</div>`,u=e=>`${e.replace("export default ","const $reactApp = ").replace(/App\.__style__(\s*)=(\s*)`([\s\S]*)?`/,"")};\nReactDOM.createRoot(document.getElementById("app")).render(React.createElement($reactApp))`,m=e=>e.replace(/export\s+default\s*\{(\n*[\s\S]*)\n*\}\s*;?$/u,"Vue.createApp({$1}).mount('#app')").replace(/export\s+default\s*define(Async)?Component\s*\(\s*\{(\n*[\s\S]*)\n*\}\s*\)\s*;?$/u,"Vue.createApp({$1}).mount('#app')").trim(),v=e=>`(function(exports){var module={};module.exports=exports;${e};return module.exports.__esModule?module.exports.default:module.exports;})({})`,h={};var y=e({name:"CodeDemo",props:{id:{type:String,required:!0},type:{type:String,default:"normal"},title:{type:String,default:""},config:{type:String,default:""},code:{type:String,required:!0}},setup(e,{slots:n}){const y=t(!1),b=t(null),g=t(null),f=t("0"),w=t(!1),j=s((()=>JSON.parse(decodeURIComponent(e.config||"{}")))),L=s((()=>(e=>{const t=Object.keys(e),s={html:[],js:[],css:[],isLegal:!1};return["html","js","css"].forEach((a=>{const l=t.filter((e=>o[a].types.includes(e)));if(l.length){const t=l[0];s[a]=[e[t].replace(/^\n|\n$/g,""),o[a].map[t]||t]}})),s.isLegal=!(s.html.length&&"none"!==s.html[1]||s.js.length&&"none"!==s.js[1]||s.css.length&&"none"!==s.css[1]),s})(JSON.parse(decodeURIComponent(e.code||"{}"))))),S=s((()=>"react"===e.type?((e,t)=>{const s=r(t);return{...s,html:d(""),js:u(e.js[0]||""),css:e.css[0]||(e.js[0]?e.js[0].replace(/App\.__style__(?:\s*)=(?:\s*)`([\s\S]*)?`/,"$1").trim():""),isLegal:e.isLegal,jsLib:[s.react,s.reactDOM,...s.jsLib],jsx:!0,getScript:()=>{const t=window.Babel?.transform(e.js[0]||"",{presets:["es2015","react"]})?.code||"";return`window.ReactDOM.createRoot(document.firstElementChild).render(window.React.createElement(${v(t)}))`}}})(L.value,j.value):"vue"===e.type?((e,t)=>{const s=r(t),a=e.html[0]||"",l=/<template>([\s\S]+)<\/template>/u.exec(a),n=/<script(\s*lang=(['"])(.*?)\2)?>([\s\S]+)<\/script>/u.exec(a),o=/<style(\s*lang=(['"])(.*?)\2)?\s*(?:scoped)?>([\s\S]+)<\/style>/u.exec(a),i=l?l[1].replace(/^\n|\n$/g,""):"",[c="",p=""]=n?[n[4].replace(/^\n|\n$/g,""),n[3]]:[],[u="",h=""]=o?[o[4].replace(/^\n|\n$/g,""),o[3]]:[],y=""===p&&(""===h||"css"===h);return{...s,html:d(i),js:m(c),css:u,isLegal:y,jsLib:[s.vue,...s.jsLib],getScript:()=>{const e=t.useBabel?window.Babel?.transform(c,{presets:["es2015"]})?.code||"":c.replace(/export\s+default/u,"return");return`const app=window.document.createElement('div');document.firstElementChild.appendChild(app);const appOptions=${v(e)};appOptions.template=\`${i.replace("`",'\\`"')}\`;window.Vue.createApp(appOptions).mount(app);`}}})(L.value,j.value):((e,t)=>{const s=r(t),a=e.js[0]||"";return{...s,html:p(e.html[0]||""),js:a,css:e.css[0]||"",isLegal:e.isLegal,getScript:()=>s.useBabel?window.Babel.transform(a,{presets:["es2015"]})?.code||"":a}})(L.value,j.value))),x=s((()=>S.value.isLegal)),C=(t=!1)=>{const s=b.value.attachShadow({mode:"open"}),a=document.createElement("div");a.classList.add("code-demo-app"),s.appendChild(a),x.value?(t&&(a.innerHTML=S.value.html),c(s,S.value),((e,t,s)=>{const a=s.getScript();if(a&&Array.from(t.childNodes).every((e=>"SCRIPT"!==e.nodeName))){const s=document.createElement("script");s.appendChild(document.createTextNode(`{const document=window.document.querySelector('#${e} .code-demo-container').shadowRoot;\n${a}}`)),t.appendChild(s)}})(e.id,s,S.value),f.value="0"):f.value="auto",w.value=!0},M=()=>{switch(e.type){case"react":return(e=>Promise.all([i(h,e.babel),i(h,e.react),i(h,e.reactDOM)]))(S.value).then((()=>C()));case"vue":return(e=>{const t=[i(h,e.vue)];return e.useBabel&&t.push(i(h,e.babel)),Promise.all(t)})(S.value).then((()=>C()));default:return(e=>e.useBabel?i(h,e.babel):Promise.resolve())(S.value).then((()=>C(!0)))}};return a((()=>{setTimeout((()=>{M()}),MARKDOWN_ENHANCE_DELAY)})),()=>l("div",{class:"code-demo-wrapper",id:e.id},[w.value?null:l("div",{class:["loading"],innerHTML:'<svg xmlns="http://www.w3.org/2000/svg" class="loading-icon" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" stroke-width="2"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="0s"/><animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="0s"/></circle><circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" stroke-width="2"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="-0.3333333333333333s"/><animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="-0.3333333333333333s"/></circle><circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" stroke-width="2"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="-0.6666666666666666s"/><animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="-0.6666666666666666s"/></circle></svg>'}),l("div",{class:"code-demo-header"},[S.value.isLegal?l("button",{class:["toggle-button",y.value?"down":"right"],onClick:()=>{f.value=y.value?"0":`${g.value.clientHeight+13.8}px`,y.value=!y.value}}):null,e.title?l("span",{class:"title"},decodeURIComponent(e.title)):null,S.value.isLegal&&!1!==S.value.jsfiddle?l("form",{class:"code-demo-jsfiddle",target:"_blank",action:"https://jsfiddle.net/api/post/library/pure/",method:"post"},[l("input",{type:"hidden",name:"html",value:S.value.html}),l("input",{type:"hidden",name:"js",value:S.value.js}),l("input",{type:"hidden",name:"css",value:S.value.css}),l("input",{type:"hidden",name:"wrap",value:"1"}),l("input",{type:"hidden",name:"panel_js",value:"3"}),l("input",{type:"hidden",name:"resources",value:[...S.value.cssLib,...S.value.jsLib].join(",")}),l("button",{type:"submit",class:"jsfiddle-button",innerHTML:'<svg class="jsfiddle-icon" viewBox="0 0 1170 1024" xmlns="http://www.w3.org/2000/svg" width="228.516" height="200"><path d="M1028.571 441.143q63.429 26.286 102.572 83.143t39.143 126.571q0 93.714-67.429 160.286T940 877.714q-2.286 0-6.571-.285t-6-.286H232q-97.143-5.714-164.571-71.714T0 645.143q0-62.857 31.429-116t84-84q-6.858-22.286-6.858-46.857 0-65.715 46.858-112T269.143 240q54.286 0 98.286 33.143 42.857-88 127.142-141.714t186.572-53.715q94.857 0 174.857 46t126.571 124.857 46.572 172q0 3.429-.286 10.286t-.286 10.286zm-761.142 152q0 69.714 48 110.286T434.286 744q78.285 0 137.143-56.571-9.143-11.429-27.143-32.286t-24.857-28.857q-38.286 37.143-82.286 37.143-31.429 0-53.429-19.143t-22-50q0-30.286 22-49.715T436 525.143q25.143 0 48.286 12T526 568.57t37.143 42.858 39.428 46.857 44 42.857T702 732.57t69.429 12q69.142 0 116.857-40.857T936 594.857q0-69.143-48-109.714T769.714 444.57Q688 444.571 632 500l53.143 61.714q37.714-36.571 81.143-36.571 29.714 0 52.571 18.857t22.857 48q0 32.571-21.143 52.286T766.857 664q-24.571 0-47.143-12t-41.143-31.429-37.428-42.857-39.714-46.857T557.143 488 502 456.571t-67.714-12q-69.715 0-118.286 40.286t-48.571 108.286z"/></svg>',"aria-label":"JSFiddle","data-balloon-pos":"up"})]):null,S.value.isLegal&&!1===S.value.codepen?null:l("form",{class:"code-demo-codepen",target:"_blank",action:"https://codepen.io/pen/define",method:"post"},[l("input",{type:"hidden",name:"data",value:JSON.stringify({html:S.value.html,js:S.value.js,css:S.value.css,js_external:S.value.jsLib.join(";"),css_external:S.value.cssLib.join(";"),layout:S.value.codepenLayout,html_pre_processor:L.value?L.value.html[1]:"none",js_pre_processor:L.value?L.value.js[1]:S.value.jsx?"babel":"none",css_pre_processor:L.value?L.value.css[1]:"none",editors:S.value.codepenEditors})}),l("button",{type:"submit",innerHTML:'<svg class="codepen-icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M123.429 668L468 897.714V692.571L277.143 565.143zM88 585.714L198.286 512 88 438.286v147.428zm468 312L900.571 668 746.857 565.143 556 692.57v205.143zM512 616l155.429-104L512 408 356.571 512zM277.143 458.857L468 331.43V126.286L123.429 356zM825.714 512L936 585.714V438.286zm-78.857-53.143L900.571 356 556 126.286v205.143zM1024 356v312q0 23.429-19.429 36.571l-468 312Q524.571 1024 512 1024t-24.571-7.429l-468-312Q0 691.43 0 668V356q0-23.429 19.429-36.571l468-312Q499.429 0 512 0t24.571 7.429l468 312Q1024 332.57 1024 356z"/></svg>',class:"codepen-button","aria-label":"Codepen","data-balloon-pos":"up"})])]),l("div",{ref:b,class:"code-demo-container",style:{display:x.value&&w.value?"block":"none"}}),l("div",{class:"code-demo-code-wrapper",style:{height:f.value}},l("div",{ref:g,class:"code-demo-codes"},n.default?.()))])}});export{y as default};
//# sourceMappingURL=CodeDemo.js.map
