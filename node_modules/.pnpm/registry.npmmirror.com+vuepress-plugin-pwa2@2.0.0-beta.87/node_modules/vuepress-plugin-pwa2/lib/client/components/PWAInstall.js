import{h as e,defineComponent as a,ref as l,onMounted as t,computed as o}from"vue";import{IconBase as n,useLocaleConfig as s}from"vuepress-shared/lib/client";import{useEventListener as i}from"@vueuse/core";import{withBase as c}from"@vuepress/client";import"../styles/modal.scss";const r=()=>e(n,{name:"arrow-left"},(()=>e("path",{d:"M802.8 448h-428l166-158.8c23.8-25 23.8-65.4 0-90.4s-62.4-25-86.4 0L178 466.8c-12 11.6-18 27.4-18 44.8v0.8c0 17.4 6 33.2 18 44.8l276.2 268c24 25 62.6 25 86.4 0 23.8-25 23.8-65.4 0-90.4l-166-158.8h428c33.8 0 61.2-28.6 61.2-64 0.2-36-27.2-64-61-64z"})));r.displayName="ArrowLeftIcon";const u=()=>e(n,{name:"arrow-right"},(()=>e("path",{d:"M569.8 825.2l276.2-268c12-11.6 18-27.4 18-44.8v-0.8c0-17.4-6-33.2-18-44.8l-276.2-268c-24-25-62.6-25-86.4 0-23.8 25-23.8 65.4 0 90.4l166 158.8h-428c-34 0-61.4 28.6-61.4 64 0 36 27.4 64 61.2 64h428l-166 158.8c-23.8 25-23.8 65.4 0 90.4 24 25 62.6 25 86.6 0z"})));u.displayName="ArrowRightIcon";const v=()=>e(n,{name:"close"},(()=>e("path",{d:"M589.654 511.965 1007.212 84.22a49.777 49.777 0 0 0-.73-70.02 49.046 49.046 0 0 0-69.687.665L519.967 441.946 85.882 14.2a49.08 49.08 0 0 0-69.687.664 49.777 49.777 0 0 0 .664 70.019l433.454 427.082L16.859 939.048a49.777 49.777 0 0 0-.664 70.019 49.013 49.013 0 0 0 69.687.663l434.085-427.746 416.828 427.083A49.013 49.013 0 0 0 972.037 1024a48.416 48.416 0 0 0 34.512-14.27 49.777 49.777 0 0 0 .73-70.019z"})));v.displayName="CloseIcon";const d=PWA_LOCALES;var p=a({name:"PWAInstallModal",components:{ArrowLeftIcon:r,ArrowRightIcon:u,CloseIcon:v},props:{useHint:Boolean},emits:["can-install","hint","toggle"],setup(a,{emit:o}){const n=s(d),p=l({}),h=l(null),m=()=>{const e=document.querySelector(".screenshot");e&&e.scrollBy({left:-e.clientWidth,top:0,behavior:"smooth"})},g=()=>{const e=document.querySelector(".screenshot");e&&e.scrollBy({left:e.clientWidth,top:0,behavior:"smooth"})},f=async()=>{if(h.value){h.value.prompt(),document.dispatchEvent(new CustomEvent("show"));"accepted"===(await h.value.userChoice).outcome?(console.info("PWA has been installed"),o("toggle",!1),o("can-install",!1)):(console.info("You choose to not install PWA"),o("toggle",!1),o("can-install",!1))}},w=()=>{console.info("You accepted the install hint"),o("hint")};return t((()=>{window.hasOwnProperty("BeforeInstallPromptEvent")&&(i(window,"beforeinstallprompt",(e=>{h.value=e,o("can-install",!0),e.preventDefault(),i("keyup",(e=>{"Escape"===e.key&&o("toggle",!1)}))})),(async()=>{const e=localStorage.getItem("manifest");if(e)p.value=JSON.parse(e);else try{const e=await fetch(c("manifest.webmanifest")),a=await e.json();p.value=a,localStorage.setItem("manifest",JSON.stringify(a))}catch(e){console.error("[PWA]: Error getting manifest, check that you have a valid web manifest or network connection")}})())})),()=>e("div",{id:"install-modal-wrapper"},[e("div",{class:"background",onClick:()=>o("toggle",!1)}),e("div",{class:"install-modal"},[e("div",{class:"header"},[e("button",{class:"close-button","aria-label":n.value.close,onClick:()=>o("toggle",!1)},e(v)),e("div",{class:"logo"},[p.value.icons?e("img",{src:p.value.icons[0]?.src,alt:"App Logo"}):null,e("div",{class:"title"},[e("h1",p.value.short_name||p.value.name),e("p",{class:"desc"},n.value.explain)])])]),e("div",{class:"content"},[e("div",{class:"highlight"},[p.value.features?e("div",{class:"feature-wrapper"},[e("h3",n.value.feature),e("ul",p.value.features.map((a=>e("li",a))))]):null,p.value.screenshots?e("div",{class:"screenshot-wrapper"},[e("button",{"aria-label":n.value.prevImage,onClick:m},e(r)),e("section",{class:"screenshot"},[p.value.screenshots.map((a=>e("div",e("img",{src:a.src,alt:"App Screenshot"}))))]),e("button",{"aria-label":n.value.nextImage,onClick:g},e(u))]):null]),e("div",{class:"description"},[e("h3",n.value.desc),e("p",p.value.description)])]),a.useHint?e("div",{class:"ios-text",onClick:w},[e("p",n.value.iOSInstall),e("button",{class:"success"},"Got it!")]):e("div",{class:"button-wrapper"},[e("button",{class:"install-button",onClick:f},[n.value.install,e("span",p.value.short_name)]),e("button",{class:"cancel-button",onClick:()=>o("toggle",!1)},n.value.cancel)])])])}}),h=a({name:"PWAInstall",setup(){const a=s(d),n=l(!1),i=l(!1),c=l(!1),r=l(!1),u=l(!1),v=l(!1),h=o((()=>r.value&&u.value&&!1===v.value)),m=o((()=>i.value&&n.value||h.value));return t((()=>{if(navigator.standalone?navigator.standalone:matchMedia("(display-mode: standalone)").matches){const{userAgent:e}=navigator;r.value=e.includes("iPhone")||e.includes("iPad")||Boolean(e.includes("Macintosh")&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2),u.value=navigator.userAgent.includes("Safari")&&!e.includes("Chrome"),v.value=Boolean(localStorage.getItem("iOS-pwa-hint"))}"getInstalledRelatedApps"in navigator&&navigator.getInstalledRelatedApps().then((e=>{i.value=e.length>0}))})),()=>e("div",{id:"pwa-install"},[m.value?e("button",{class:"modal-button",useHint:h.value,onClick:()=>{c.value=!0}},a.value.install):null,e(p,{style:{display:c.value?"block":"none"},onCanInstall:e=>{n.value=e},onHint:()=>(c.value=!1,v.value=!0,void localStorage.setItem("iOS-pwa-hint","hinted")),onToggle:e=>{c.value=e}})])}});export{h as default};
//# sourceMappingURL=PWAInstall.js.map
