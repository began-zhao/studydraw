"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@vuepress/utils"),t=require("vuepress-shared"),a=require("@vuepress/shared"),n=require("sitemap");const i=new t.Logger("vuepress-plugin-sitemap2"),s=({options:e,deprecatedOption:t,newOption:a,msg:n="",scope:s=""})=>{if(t in e){if(i.warn(`"${t}" is deprecated${s?` in ${s}`:""}, please use "${a}" instead.${n?`\n${n}`:""}`),a.includes(".")){const n=a.split(".");let i=e;n.forEach(((a,s)=>{s!==n.length-1?(i[a]=i[a]||{},i=i[a]):i[a]=e[t]}))}else e[a]=e[t];delete e[t]}},r=[],o=e=>({defaultPath:e.path.replace(e.pathLocale,"/"),pathLocale:e.pathLocale}),p=async(t,s)=>{const{extraUrls:p=[],xmlNameSpace:l}=s,d=a.isLinkHttp(s.hostname)?a.removeEndingSlash(s.hostname):`https://${a.removeEndingSlash(s.hostname)}`,c=s.sitemapFilename?a.removeLeadingSlash(s.sitemapFilename):"sitemap.xml",{dir:m,options:{base:u}}=t;await e.withSpinner(`Generating sitemap to ${e.chalk.cyan(c)}`)((()=>new Promise((h=>{const g=new n.SitemapStream({hostname:d,...l?{xmlns:l}:{}}),f=((e,t)=>{const{changefreq:n,excludeUrls:s=["/404.html"],modifyTimeGetter:p=(e=>e.data.git?.updatedTime?new Date(e.data.git.updatedTime).toISOString():"")}=t,{pages:l,options:{base:d,locales:c}}=e,m=l.reduce(((e,t)=>{const{defaultPath:a,pathLocale:n}=o(t),i=e.get(a)||[];return i.push(n),e.set(a,i)}),new Map),u=new Map;return l.forEach((t=>{const l=t.frontmatter.sitemap||{},h=(t.frontmatter.head||[]).find((e=>"robots"===e[1].name));if((h?(h[1].content||"").split(/,/u).map((e=>e.trim())).includes("noindex"):l.exclude)||s.includes(t.path))return;const g=p(t),{defaultPath:f}=o(t),$=m.get(f)||[];let w=[];$.length>1&&(e.env.isDebug&&$.forEach((e=>{c[e].lang||r.includes(e)||(i.warn(`'lang' option for ${e} is missing`),r.push(e))})),w=$.map((e=>({lang:c[e]?.lang||"en",url:`${d}${a.removeLeadingSlash(f.replace(/^\//u,e))}`}))));const S={...n?{changefreq:n}:{},links:w,...g?{lastmod:g}:{},...l};e.env.isDebug&&i.info(`sitemap option for ${t.path}: ${JSON.stringify(S,null,2)}`),u.set(t.path,S)})),u})(t,s),$=m.dest(c),w=e.fs.createWriteStream($);g.pipe(w),f.forEach(((e,t)=>g.write({url:`${u}${a.removeLeadingSlash(t)}`,...e}))),p.forEach((e=>g.write({url:`${u}${a.removeLeadingSlash(e)}`}))),g.end((()=>{h()}))}))));const h=m.dest("robots.txt");e.fs.existsSync(h)&&await e.withSpinner(`Appended sitemap path to ${e.chalk.cyan("robots.txt")}`)((async()=>{const t=`${(await e.fs.readFile(h,{encoding:"utf8"})).replace(/^Sitemap: .*$/u,"")}\nSitemap: ${d}${u}${c}\n`;await e.fs.writeFile(h,t,{flag:"w"})}))},l=(t,a=!1)=>n=>{a&&(e=>{s({options:e,deprecatedOption:"urls",newOption:"extraUrls"}),s({options:e,deprecatedOption:"exclude",newOption:"excludeUrls"}),s({options:e,deprecatedOption:"outFile",newOption:"sitemapFilename"}),s({options:e,deprecatedOption:"dateFormatter",newOption:"modifyTimeGetter"})})(t),n.env.isDebug&&i.info(`Options: ${t.toString()}`);const r={name:"vuepress-plugin-sitemap2"};return t.hostname?{...r,onGenerated:e=>p(e,t)}:(i.error(`Option ${e.chalk.magenta("hostname")} is required!`),r)};exports.default=l,exports.sitemapPlugin=l;
//# sourceMappingURL=index.js.map
