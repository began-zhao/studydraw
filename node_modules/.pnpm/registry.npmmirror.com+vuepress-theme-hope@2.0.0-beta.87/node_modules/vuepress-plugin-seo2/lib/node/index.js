"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@vuepress/utils"),t=require("vuepress-shared"),a=require("gray-matter"),r=require("@vuepress/shared");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=n(a);const i=new t.Logger("vuepress-plugin-seo2"),s=({frontmatter:e},{hostname:a},{options:{base:r}})=>{const{banner:n,cover:o}=e;if(n){if(t.isAbsoluteUrl(n))return c(a,r,n);if(t.isUrl(n))return n}if(o){if(t.isAbsoluteUrl(o))return c(a,r,o);if(t.isUrl(o))return o}return null},l=({content:e},{hostname:a},{options:{base:r}})=>{const n=/!\[.*?\]\((.*?)\)/giu.exec(e);return n?n.map((([,e])=>t.isAbsoluteUrl(e)?c(a,r,e):t.isUrl(e)?e:null)).filter((e=>null!==e)):[]},c=(e,t,a)=>`${r.isLinkHttp(e)?r.removeEndingSlash(e):`https://${r.removeEndingSlash(e)}`}${t}${r.removeLeadingSlash(a)}`,g=(e,t,a="",r="")=>{t in e&&(i.error(`"${t}" is removed${r?`, please use ${r} instead.`:" and no longer supported"}${a?`\n${a}`:""}`),r||delete e[t])},u=(e,a,r)=>{const{isArticle:n=(e=>Boolean(e.filePathRelative&&!e.frontmatter.home))}=a,{options:{base:o},siteData:i}=r,{frontmatter:{author:g,time:u,date:p=u,tag:m,tags:d=m},data:{git:f={}}}=e,h=i.locales[e.pathLocale]?.title||i.title||i.locales["/"]?.title||"",$=!1===g?[]:t.getAuthor(g||a.author),{updatedTime:v}=f,b=v?new Date(v).toISOString():"",y=Array.isArray(d)?d:"string"==typeof m?[m]:[],S=e.title,w=s(e,a,r),D=l(e,a,r),x=((e,t)=>Object.entries(t).map((([,e])=>e.lang)).filter((t=>"string"==typeof t&&t!==e)))(e.lang,i.locales);let O="";if(p instanceof Date)O=new Date(p).toISOString();else if(p){const e=t.getDate(p);e&&e.value&&(O=e.value.toISOString())}const A=w||D[0]||a.fallBackImage||"";return{"og:url":c(a.hostname,o,e.path),"og:site_name":h,"og:title":S,"og:description":e.frontmatter.description||a.autoDescription&&e.frontmatter.summary||"","og:type":n(e)?"article":"website","og:image":A,"og:updated_time":b,"og:locale":e.lang,"og:locale:alternate":x,...a.restrictions?{"og:restrictions:age":a.restrictions}:{},...a.twitterID?{"twitter:creator":a.twitterID}:{},...A?{"twitter:card":"summary_large_image","twitter:image:alt":S}:{},"article:author":$[0]?.name,"article:tag":y,"article:published_time":O,"article:modified_time":b}},p=(e,{name:t,content:a,attribute:r=(["article:","og:"].some((e=>t.startsWith(e)))?"property":"name")})=>{a&&e.push(["meta",{[r]:t,content:a}])},m=(e,a,n)=>{const o=e.frontmatter.head||[],i=u(e,a,n),c=((e,a,r)=>{const{isArticle:n=(e=>Boolean(e.filePathRelative&&!e.frontmatter.home))}=a,{frontmatter:{author:o,time:i,date:c=i},data:{git:g={}}}=e,u=!1===o?[]:t.getAuthor(o||a.author),{updatedTime:p}=g,m=p?new Date(p).toISOString():"",d=e.title,f=s(e,a,r),h=l(e,a,r);let $="";if(c instanceof Date)$=new Date(c).toISOString();else if(c){const e=t.getDate(c);e&&e.value&&($=e.value.toISOString())}return n(e)?{"@context":"https://schema.org","@type":"NewsArticle",headline:d,image:h.length?h:[f||a.fallBackImage||""],datePublished:$,dateModified:m,author:u.map((e=>({"@type":"Person",...e})))}:null})(e,a,n),g=a.ogp?a.ogp(i,e,n):i,m=a.jsonLd?a.jsonLd(c,e,n):null,d=((e,t)=>"function"==typeof t.canonical?t.canonical(e):"string"==typeof t.canonical?`${r.removeEndingSlash(t.canonical)}${e.path}`:null)(e,a);((e,t)=>{for(const a in t)switch(a){case"article:tag":t["article:tag"].forEach((t=>p(e,{name:"article:tag",content:t})));break;case"og:locale:alternate":t["og:locale:alternate"].forEach((a=>{a!==t["og:locale"]&&p(e,{name:"og:locale:alternate",content:a})}));break;default:t[a]&&p(e,{name:a,content:t[a]})}})(o,g),((e,t)=>{t&&e.push(["script",{type:"application/ld+json"},JSON.stringify(t)])})(o,m),((e,t)=>{t&&e.push(["link",{rel:"canonical",href:t}])})(o,d),a.customHead&&a.customHead(o,e,n),e.frontmatter.head=o},d=(a,r=!1)=>n=>{r&&(e=>{g(e,"seo","","ogp"),g(e,"customMeta","","customHead")})(a),n.env.isDebug&&i.info(`Options: ${a.toString()}`);const s={name:"vuepress-plugin-seo2"};return a.hostname?{...s,extendsPage:(e,r)=>{var n;e.frontmatter.description||(e.frontmatter.summary=t.stripTags(e.excerpt)||(n=e.content,n?((e="")=>e.replace(/<\/?.+?\/?>/g,""))(o.default(n).content).replace(/!\[(.*?)\]\(.*?\)/gm,"").replace(/```([\s\S]*?)```/g,"").replace(/^\s*:::\s*$/gm,"").replace(/^\s*:::\s*(.+?)(?:\s+(.*))?$/gm,"$2").replace(/^# (.*)$/gm,"$1").replace(/^#{1,6} (.*)$/gm,"$1").replace(/^\s*[-*+] (.*)$/gm,"$1; ").replace(/^\s*>+(.*)$/gm,'"$1"').replace(/(^|[^\\])\[(.*?)\]\(.*?\)/gm,"$1$2").replace(/`{1,2}([^`])(.*?)`{1,2}/g,"$1$2").replace(/~~(.*?)~~/g,"").replace(/(^|[^\\])([*|_]{1,2})(.*?)([^\\])\2/gm,"$1$3$4").replace(/<\/?.+?\/?>/g,"").split("\n").map((e=>e.trim())).join("\n").replace(/(?:\r?\n)+/g," ").replace(/ +/g," ").trim():"").slice(0,180)||""),m(e,a,r)},onGenerated:t=>(async t=>{i.load("Generating robots.txt");const a=t.public("robots.txt");let r=e.fs.existsSync(a)?await e.fs.readFile(a,{encoding:"utf8"}):"";r&&!r.includes("User-agent")?(i.error(),i.update("robots.txt seems invalid!")):(r+="\nUser-agent:*\nDisallow:\n",await e.fs.writeFile(t.dest("robots.txt"),r,{flag:"w"}),i.succeed())})(t.dir)}:(i.error(`Option ${e.chalk.magenta("hostname")} is required!`),s)};exports.default=d,exports.seoPlugin=d;
//# sourceMappingURL=index.js.map
